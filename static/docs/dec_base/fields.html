<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>fields.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>fields.py</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-0'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-0">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">FileField</span>
<span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.template.defaultfilters</span> <span class="kn">import</span> <span class="n">filesizeformat</span>

<span class="kn">from</span> <span class="nn">south.modelsinspector</span> <span class="kn">import</span> <span class="n">add_introspection_rules</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-1'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-1">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">ContentTypeRestrictedFileField</span><span class="p">(</span><span class="n">FileField</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Same as Django&#39;s normal FileField, but you can specify:</span>
<span class="sd">    * content_types - a list containing allowed MIME types. Example: [&#39;application/pdf&#39;, &#39;image/jpeg&#39;]</span>
<span class="sd">    * max_upload_size - a number indicating the maximum file size allowed for upload.</span>
<span class="sd">        2.5MB - 2621440</span>
<span class="sd">        5MB - 5242880</span>
<span class="sd">        10MB - 10485760</span>
<span class="sd">        20MB - 20971520</span>
<span class="sd">        50MB - 5242880</span>
<span class="sd">        100MB - 104857600</span>
<span class="sd">        250MB - 214958080</span>
<span class="sd">        500MB - 429916160</span>
<span class="sd">    &#39;&#39;&#39;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-2'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-2">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_types</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_upload_size</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content_types</span> <span class="o">=</span> <span class="n">content_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_upload_size</span> <span class="o">=</span> <span class="n">max_upload_size</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ContentTypeRestrictedFileField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-3'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-3">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ContentTypeRestrictedFileField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">file</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">content_type</span>
            <span class="k">if</span> <span class="n">content_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_upload_size</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s">&#39;Maximum filesize is {0} (actual filesize was {1}).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filesizeformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_upload_size</span><span class="p">),</span> <span class="n">filesizeformat</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">size</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s">&#39;That filetype is not permitted.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">data</span>

<span class="n">add_introspection_rules</span><span class="p">([],</span> <span class="p">[</span><span class="s">&quot;^dec_base\.fields\.ContentTypeRestrictedFileField&quot;</span><span class="p">])</span>

</pre></div></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
