<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>sfquery.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>sfquery.py</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-0'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-0">#</a>
        </div>
        <p>vi:ts=4:et</p>
<p>sfquery -- Source Forge query script using the ClientCGI high-level interface</p>
<p>Retrieves a SourceForge XML export object for a given project.
Specify the <em>numeric</em> project ID. the user name, and the password,
as arguments. If you have a valid ~/.netrc entry for sourceforge.net,
you can just give the project ID.</p>
<p>By Eric S. Raymond, August 2002.  All rites reversed.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">netrc</span>
<span class="kn">import</span> <span class="nn">curl</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-1'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-1">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">SourceForgeUserSession</span><span class="p">(</span><span class="n">curl</span><span class="o">.</span><span class="n">Curl</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-2'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-2">#</a>
        </div>
        <p>SourceForge-specific methods.  Sensitive to changes in site design.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="s">&quot;Establish a login session.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&quot;account/login.php&quot;</span><span class="p">,</span> <span class="p">((</span><span class="s">&quot;form_loginname&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s">&quot;form_pw&quot;</span><span class="p">,</span> <span class="n">password</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s">&quot;return_to&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s">&quot;stay_in_ssl&quot;</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s">&quot;login&quot;</span><span class="p">,</span> <span class="s">&quot;Login With SSL&quot;</span><span class="p">)))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-3'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-3">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Log out of SourceForge.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;account/logout.php&quot;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-4'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-4">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">fetch_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;export/xml_export.php?group_id=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">numid</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">project_id</span> <span class="o">=</span> <span class="s">&#39;28236&#39;</span>    <span class="c"># PyCurl project ID</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">project_id</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-5'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-5">#</a>
        </div>
        <p>Try to grab authenticators out of your .netrc</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">try</span><span class="p">:</span>
        <span class="n">auth</span> <span class="o">=</span> <span class="n">netrc</span><span class="o">.</span><span class="n">netrc</span><span class="p">()</span><span class="o">.</span><span class="n">authenticators</span><span class="p">(</span><span class="s">&quot;sourceforge.net&quot;</span><span class="p">)</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">auth</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Usage: </span><span class="si">%s</span><span class="s"> &lt;project id&gt; &lt;username&gt; &lt;password&gt;&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">SourceForgeUserSession</span><span class="p">(</span><span class="s">&quot;https://sourceforge.net/&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-6'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-6">#</a>
        </div>
        <p>Login could fail.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">answered</span><span class="p">(</span><span class="s">&quot;Invalid Password or User Name&quot;</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Login/password not accepted (</span><span class="si">%d</span><span class="s"> bytes)</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">body</span><span class="p">()))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-7'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-7">#</a>
        </div>
        <p>We'll see this if we get the right thing.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">elif</span> <span class="n">session</span><span class="o">.</span><span class="n">answered</span><span class="p">(</span><span class="s">&quot;Personal Page For: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">session</span><span class="o">.</span><span class="n">fetch_xml</span><span class="p">(</span><span class="n">project_id</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">body</span><span class="p">())</span>
        <span class="n">session</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-8'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-8">#</a>
        </div>
        <p>Or maybe SourceForge has changed its site design so our check strings
are no longer valid.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Unexpected page (</span><span class="si">%d</span><span class="s"> bytes)</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">body</span><span class="p">()))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</pre></div></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
