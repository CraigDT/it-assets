<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>adapter.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>adapter.py</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-0'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-0">#</a>
        </div>
        <p>Copyright (c) 2006-2011, Prometheus Research, LLC
See <code>LICENSE</code> for license information, <code>AUTHORS</code> for the list of authors.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-1'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-1">#</a>
        </div>
        <h1>:mod:<code>htsql.adapter</code></h1>
<p>This module provides a mechanism for pluggable extensions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">listof</span><span class="p">,</span> <span class="n">aresubclasses</span><span class="p">,</span> <span class="n">toposort</span>
<span class="kn">from</span> <span class="nn">.context</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">types</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-2'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-2">#</a>
        </div>
        <p>A unit of extension in the HTSQL component architecture.</p>
<p><em>HTSQL component architecture</em> allows you to:</p>
<ul>
<li>
<p>declare <em>interfaces</em> that provide various services;</p>
</li>
<li>
<p>define <em>components</em> implementing the interfaces;</p>
</li>
<li>
<p>given an interface and a <em>dispatch key</em>, produce a component which
implements the interface for the given key.</p>
</li>
</ul>
<p>Three types of interfaces are supported: <em>utilities</em>, <em>adapters</em> and
<em>protocols</em>; see :class:<code>Utility</code>, :class:<code>Adapter</code>, :class:<code>Protocol</code>
respectively.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Component</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-3'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-3">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-4'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-4">#</a>
        </div>
        <p>Augment method names with prefix <code>&lt;name&gt;.</code> to make the adapter
name visible in tracebacks.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">class</span> <span class="nc">__metaclass__</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-5'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-5">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-6'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-6">#</a>
        </div>
        <p>Iterate over all values in the class namespace.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">values</span><span class="p">():</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-7'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-7">#</a>
        </div>
        <p>Ignore non-function attributes.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">):</span>
                    <span class="k">continue</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-8'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-8">#</a>
        </div>
        <p>Update the code name and regenerate the code object.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="n">code</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">func_code</span>
                <span class="n">code_name</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">co_name</span>
                <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">code_name</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">code_name</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">code_name</span><span class="p">)</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">CodeType</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_argcount</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_nlocals</span><span class="p">,</span>
                                      <span class="n">code</span><span class="o">.</span><span class="n">co_stacksize</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_flags</span><span class="p">,</span>
                                      <span class="n">code</span><span class="o">.</span><span class="n">co_code</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_consts</span><span class="p">,</span>
                                      <span class="n">code</span><span class="o">.</span><span class="n">co_names</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">,</span>
                                      <span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="n">code_name</span><span class="p">,</span>
                                      <span class="n">code</span><span class="o">.</span><span class="n">co_firstlineno</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_lnotab</span><span class="p">,</span>
                                      <span class="n">code</span><span class="o">.</span><span class="n">co_freevars</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_cellvars</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-9'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-9">#</a>
        </div>
        <p>Patch the function object.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="n">value</span><span class="o">.</span><span class="n">func_code</span> <span class="o">=</span> <span class="n">code</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-10'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-10">#</a>
        </div>
        <p>Create the class.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

    <span class="nd">@staticmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-11'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-11">#</a>
        </div>
        <p>Produce a list of all components of the active application.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">components</span><span class="p">():</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-12'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-12">#</a>
        </div>
        <p>Get the component registry of the active application.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">registry</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">htsql</span><span class="o">.</span><span class="n">component_registry</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-13'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-13">#</a>
        </div>
        <p>A shortcut: return cached components.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">registry</span><span class="o">.</span><span class="n">components</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">registry</span><span class="o">.</span><span class="n">components</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-14'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-14">#</a>
        </div>
        <p>Packages exported by the addons of the active application.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">packages</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">addon</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">addons</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-15'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-15">#</a>
        </div>
        <p>In Python 2.6+:
root_package = sys.modules[addon.<strong>module</strong>].<strong>package</strong></p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="n">root_package</span> <span class="o">=</span> <span class="n">addon</span><span class="o">.</span><span class="n">__module__</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">root_package</span><span class="p">],</span> <span class="s">&#39;__path__&#39;</span><span class="p">):</span>
                <span class="n">root_package</span> <span class="o">=</span> <span class="n">root_package</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-16'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-16">#</a>
        </div>
        <p>An addon exports packages defined in <code>packages</code> attribute.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">addon</span><span class="o">.</span><span class="n">packages</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-17'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-17">#</a>
        </div>
        <p>Resolve relative package names.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="k">if</span> <span class="n">package</span> <span class="o">==</span> <span class="s">&#39;.&#39;</span><span class="p">:</span>
                    <span class="n">package</span> <span class="o">=</span> <span class="n">root_package</span>
                <span class="k">elif</span> <span class="n">package</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
                    <span class="n">package</span> <span class="o">=</span> <span class="n">root_package</span><span class="o">+</span><span class="n">package</span>
                <span class="n">packages</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">package</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-18'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-18">#</a>
        </div>
        <p>All modules exported by the addons.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">modules</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-19'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-19">#</a>
        </div>
        <p>In Python 2.6+:
package = sys.modules[module].<strong>package</strong></p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="n">package</span> <span class="o">=</span> <span class="n">module</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">package</span><span class="p">],</span> <span class="s">&#39;__path__&#39;</span><span class="p">):</span>
                <span class="n">package</span> <span class="o">=</span> <span class="n">package</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
                <span class="n">modules</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">module</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-20'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-20">#</a>
        </div>
        <p>A list of <code>Component</code> subclasses defined in the <code>modules</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="n">Component</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">subclass</span> <span class="ow">in</span> <span class="n">components</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">():</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-21'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-21">#</a>
        </div>
        <p>Skip realizations.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="n">Realization</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">subclass</span><span class="o">.</span><span class="n">__module__</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
                    <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subclass</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-22'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-22">#</a>
        </div>
        <p>Cache and return the components.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">registry</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">components</span>
        <span class="k">return</span> <span class="n">components</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-23'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-23">#</a>
        </div>
        <p>Produces a list of all components implementing the interface.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">implementations</span><span class="p">(</span><span class="n">interface</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-24'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-24">#</a>
        </div>
        <p>Get the component registry of the active application.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">registry</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">htsql</span><span class="o">.</span><span class="n">component_registry</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-25'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-25">#</a>
        </div>
        <p>A shortcut: return cached implementations.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">registry</span><span class="o">.</span><span class="n">implementations</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-26'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-26">#</a>
        </div>
        <p>Get all active components.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">components</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">components</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-27'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-27">#</a>
        </div>
        <p>Leave only components implementing the interface.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">implementations</span> <span class="o">=</span> <span class="p">[</span><span class="n">component</span>
                           <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span>
                           <span class="k">if</span> <span class="n">component</span><span class="o">.</span><span class="n">implements</span><span class="p">(</span><span class="n">interface</span><span class="p">)]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-28'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-28">#</a>
        </div>
        <p>Cache and return the implementations.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">registry</span><span class="o">.</span><span class="n">implementations</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span> <span class="o">=</span> <span class="n">implementations</span>
        <span class="k">return</span> <span class="n">implementations</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-29'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-29">#</a>
        </div>
        <p>Produces a realization of the interface for the given dispatch key.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">realize</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">dispatch_key</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-30'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-30">#</a>
        </div>
        <p>Get the component registry of the active application.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">registry</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">htsql</span><span class="o">.</span><span class="n">component_registry</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-31'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-31">#</a>
        </div>
        <p>A shortcut: if the realization for the given interface and the
dispatch key is already built, return it.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">registry</span><span class="o">.</span><span class="n">realizations</span><span class="p">[</span><span class="n">interface</span><span class="p">,</span> <span class="n">dispatch_key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-32'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-32">#</a>
        </div>
        <p>Get the implementations of the interface.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">implementations</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">implementations</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-33'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-33">#</a>
        </div>
        <p>Leave only implementations matching the dispatch key.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">implementations</span> <span class="o">=</span> <span class="p">[</span><span class="n">implementation</span>
                           <span class="k">for</span> <span class="n">implementation</span> <span class="ow">in</span> <span class="n">implementations</span>
                           <span class="k">if</span> <span class="n">implementation</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">dispatch_key</span><span class="p">)]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-34'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-34">#</a>
        </div>
        <p>Note: commented out since we force the interface component
to match any dispatch keys.</p>
<h1>Check that we have at least one matching implementation.</h1>
<p>if not implementations:
   raise RuntimeError("when realizing interface %s.%s for key %r,"
                      " unable to find matching implementations"
                      % (interface.<strong>module</strong>, interface.<strong>name</strong>,
                         dispatch_key))</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-35'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-35">#</a>
        </div>
        <p>Generate a function:
order(implementation) -&gt; [dominated implementations].</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">order_graph</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">dominating</span> <span class="ow">in</span> <span class="n">implementations</span><span class="p">:</span>
            <span class="n">order_graph</span><span class="p">[</span><span class="n">dominating</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">dominated</span> <span class="ow">in</span> <span class="n">implementations</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dominating</span> <span class="ow">is</span> <span class="n">dominated</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">dominating</span><span class="o">.</span><span class="n">dominates</span><span class="p">(</span><span class="n">dominated</span><span class="p">):</span>
                    <span class="n">order_graph</span><span class="p">[</span><span class="n">dominating</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dominated</span><span class="p">)</span>
        <span class="n">order</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">implementation</span><span class="p">:</span> <span class="n">order_graph</span><span class="p">[</span><span class="n">implementation</span><span class="p">])</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-36'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-36">#</a>
        </div>
        <p>Now we need to order the implementations unambiguously.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">try</span><span class="p">:</span>
            <span class="n">implementations</span> <span class="o">=</span> <span class="n">toposort</span><span class="p">(</span><span class="n">implementations</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">is_total</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-37'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-37">#</a>
        </div>
        <p>We intercept exceptions to provide a nicer error message.
<code>message</code> is an explanation we discard; <code>conflict</code> is a list
of implementations which either form a domination loop or
have no ordering relation between them.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="n">message</span><span class="p">,</span> <span class="n">conflict</span> <span class="o">=</span> <span class="n">exc</span>
            <span class="n">interface_name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span>
                                        <span class="n">interface</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">component_names</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span>
                                                   <span class="n">component</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">conflict</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">conflict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">conflict</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">problem</span> <span class="o">=</span> <span class="s">&quot;an ordering loop&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">problem</span> <span class="o">=</span> <span class="s">&quot;ambiguous ordering&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-38'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-38">#</a>
        </div>
        <p>Report a problem.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;when realizing interface </span><span class="si">%s</span><span class="s"> for key </span><span class="si">%r</span><span class="s">,&quot;</span>
                               <span class="s">&quot; detected </span><span class="si">%s</span><span class="s"> in components: </span><span class="si">%s</span><span class="s">&quot;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="n">interface_name</span><span class="p">,</span> <span class="n">dispatch_key</span><span class="p">,</span>
                                  <span class="n">problem</span><span class="p">,</span> <span class="n">component_names</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-39'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-39">#</a>
        </div>
        <p>We want the most specific implementations first.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">implementations</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-40'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-40">#</a>
        </div>
        <p>Force the interface component to the list of implementations.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">interface</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">implementations</span><span class="p">:</span>
            <span class="n">implementations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interface</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-41'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-41">#</a>
        </div>
        <p>Generate the name of the realization of the form:
  interface[implementation1,implementation2,...]</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">module</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">__module__</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">[</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                           <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span>
                                               <span class="n">component</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
                                    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">implementations</span>
                                    <span class="k">if</span> <span class="n">component</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">interface</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-42'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-42">#</a>
        </div>
        <p>Get the list of bases for the realization.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">bases</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">Realization</span><span class="p">]</span> <span class="o">+</span> <span class="n">implementations</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-43'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-43">#</a>
        </div>
        <p>Class attributes for the realization.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;__module__&#39;</span><span class="p">:</span> <span class="n">module</span><span class="p">,</span>
                <span class="s">&#39;interface&#39;</span><span class="p">:</span> <span class="n">interface</span><span class="p">,</span>
                <span class="s">&#39;dispatch_key&#39;</span><span class="p">:</span> <span class="n">dispatch_key</span><span class="p">,</span>
        <span class="p">}</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-44'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-44">#</a>
        </div>
        <p>Generate the realization.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">realization</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-45'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-45">#</a>
        </div>
        <p>Cache and return the realization.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">registry</span><span class="o">.</span><span class="n">realizations</span><span class="p">[</span><span class="n">interface</span><span class="p">,</span> <span class="n">dispatch_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">realization</span>
        <span class="k">return</span> <span class="n">realization</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-46'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-46">#</a>
        </div>
        <p>Tests if the component implements the interface.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">implements</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">interface</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-47'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-47">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">interface</span><span class="p">)</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-48'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-48">#</a>
        </div>
        <p>Tests if the component dominates another component.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dominates</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-49'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-49">#</a>
        </div>
        <p>Refine in subclasses.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-50'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-50">#</a>
        </div>
        <p>Tests if the component matches a dispatch key.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">matches</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">dispatch_key</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-51'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-51">#</a>
        </div>
        <p>Override in subclasses.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="bp">False</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-52'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-52">#</a>
        </div>
        <p>Extract the dispatch key from the constructor arguments.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-53'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-53">#</a>
        </div>
        <p>Override in subclasses.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="bp">None</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-54'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-54">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-55'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-55">#</a>
        </div>
        <p>Extract polymorphic parameters.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">dispatch_key</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-56'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-56">#</a>
        </div>
        <p>Realize the interface.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">realization</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">realize</span><span class="p">(</span><span class="n">dispatch_key</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-57'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-57">#</a>
        </div>
        <p>Create an instance of the realization.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Component</span><span class="p">,</span> <span class="n">realization</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">realization</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-58'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-58">#</a>
        </div>
        <p>A realization of an interface for some dispatch key.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Realization</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-59'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-59">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">interface</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dispatch_key</span> <span class="o">=</span> <span class="bp">None</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-60'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-60">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-61'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-61">#</a>
        </div>
        <p>Bypass <code>Component.__new__</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-62'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-62">#</a>
        </div>
        <p>Implements utility interfaces.</p>
<p>An utility is an interface with a single realization.</p>
<p>This is an abstract class; to declare an utility interface, create
a subclass of :class:<code>Utility</code>.  To add an implementation of the
interface, create a subclass of the interface class.</p>
<p>The following example declared an interface <code>SayHello</code> and provide
an implementation <code>PrintHello</code> that prints <code>'Hello, World!</code> to
the standard output::</p>
<pre>class SayHello(Utility):
def __call__(self):
raise NotImplementedError("interface is not implemented")
</pre>

<p>class PrintHello(SayHello):
def <strong>call</strong>(self):
print "Hello, World!"</p>
<p>def hello():
hello = SayHello()
hello()</p>
<blockquote>
<blockquote>
<blockquote>
<p>hello()
Hello, World!</p>
</blockquote>
</blockquote>
</blockquote>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Utility</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-63'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-63">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">weight</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-64'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-64">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dominates</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">component</span><span class="o">.</span><span class="n">weight</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">weight</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-65'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-65">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">matches</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">dispatch_key</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-66'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-66">#</a>
        </div>
        <p>For an utility, the dispatch key is always a 0-tuple.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="n">dispatch_key</span> <span class="o">==</span> <span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-67'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-67">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-68'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-68">#</a>
        </div>
        <p>The dispatch key is always a 0-tuple.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-69'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-69">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">def</span> <span class="nf">weigh</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-70'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-70">#</a>
        </div>
        <p>Implements adapter interfaces.</p>
<p>An adapter interface provides mechanism for polymorphic dispatch
based on the types of the arguments.</p>
<p>This is an abstract class; to declare an adapter interface, create
a subclass of :class:<code>Adapter</code> and indicate the most generic type
signature of the polymorphic arguments using function :func:<code>adapts</code>.</p>
<p>To add an implementation of an adapter interface, create a subclass
of the interface class and indicate the matching type signatures
using functions :func:<code>adapts</code>, :func:<code>adapts_many</code>, or
:func:<code>adapts_none</code>.</p>
<p>Class attributes:</p>
<p><code>types</code> (a list of type signatures)
<pre>List of signatures that the component matches.
</pre>
<code>arity</code> (an integer)
Number of polymorphic arguments.</p>
<p>The following example declares an adapter interface <code>Format</code>
and implements it for several data types::</p>
<p>class Format(Adapter):
<pre>adapts(object)
def <strong>init</strong>(self, value):
self.value = value
def <strong>call</strong>(self):</p>
<h1>The default implementation.</h1>
<p>return str(self.value)
</pre>
class FormatString(Format):
adapts(str)
def <strong>call</strong>(self):</p>
<h1>Display alphanumeric values unquoted, the others quoted.</h1>
<p>if self.value.isalnum():
<pre>return self.value
else:
return repr(self.value)
</pre>
class FormatList(Format):
adapts(list)
def <strong>call</strong>(self):</p>
<h1>Apply <code>format</code> to the list elements.</h1>
<p>return "[%s]" % ",".join(format(item) for item in self.value)</p>
<p>def format(value):
format = Format(value)
return format()</p>
<blockquote>
<blockquote>
<blockquote>
<p>print format(123)
123
print format("ABC")
ABC
print format("Hello, World!")
'Hello, World!'
print format([123, "ABC", "Hello, World!"])
[123, ABC, 'Hello, World!']</p>
</blockquote>
</blockquote>
</blockquote>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Adapter</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-71'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-71">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">arity</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-72'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-72">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dominates</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-73'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-73">#</a>
        </div>
        <p>A component implementing an adapter interface dominates
over another component implementing the same interface
if one of the following two conditions holds:</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        </pre></div></pre></div>
      </td>
    </tr><tr id='section-74'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-74">#</a>
        </div>
        <p>(1) The component is a subclass of the other component.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-75'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-75">#</a>
        </div>
        <p>(2) The signature of the component is more specific than
    the signature of the other component.
Note: In case if the component has more than one signature,
we require that at least one of the signatures is more
specific than some signature of the other component.  This
rule does not guarantee anti-symmetricity, so ambiguously
defined implementations may make the ordering ill defined.
Validness of the ordering is verified in <code>Component.realize()</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">type_vector</span> <span class="ow">in</span> <span class="n">component</span><span class="o">.</span><span class="n">types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">other_type_vector</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">aresubclasses</span><span class="p">(</span><span class="n">type_vector</span><span class="p">,</span> <span class="n">other_type_vector</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">type_vector</span> <span class="o">!=</span> <span class="n">other_type_vector</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="bp">False</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-76'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-76">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">matches</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">dispatch_key</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-77'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-77">#</a>
        </div>
        <p>For an adapter interface, the dispatch key is a signature.
A component matches the dispatch key the component signature
is equal or less specific than the dispatch key.
Note: if the component has more than one signature, it
matches the dispatch key if at least one of its signatures
is equal or less specific than the dispatch key.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dispatch_key</span><span class="p">),</span> <span class="n">listof</span><span class="p">(</span><span class="nb">type</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">aresubclasses</span><span class="p">(</span><span class="n">dispatch_key</span><span class="p">,</span> <span class="n">type_vector</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">type_vector</span> <span class="ow">in</span> <span class="n">component</span><span class="o">.</span><span class="n">types</span><span class="p">)</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-78'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-78">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-79'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-79">#</a>
        </div>
        <p>The types of the leading arguments of the constructor
form a dispatch key.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="n">interface</span><span class="o">.</span><span class="n">arity</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">type_vector</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="n">interface</span><span class="o">.</span><span class="n">arity</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">type_vector</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-80'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-80">#</a>
        </div>
        <p>Specifies the adapter signature.</p>
<p>The component matches the specified or any more specific
signature.</p>
<p>Use it in the namespace of the component, for example::</p>
<pre>class DoSmth(Adapter):
</pre>

<pre>adapts(T1, T2, ...)
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">def</span> <span class="nf">adapts</span><span class="p">(</span><span class="o">*</span><span class="n">type_vector</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-81'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-81">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">type_vector</span><span class="p">),</span> <span class="n">listof</span><span class="p">(</span><span class="nb">type</span><span class="p">))</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s">&#39;types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">type_vector</span><span class="p">]</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s">&#39;arity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_vector</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-82'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-82">#</a>
        </div>
        <p></pre>Indicates that the adapter does not match any signatures.</p>
<p>Use it in the namespace of the adapter, for example::</p>
<pre>class DoSmth(Adapter):
</pre>

<pre>adapts_none()
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">def</span> <span class="nf">adapts_none</span><span class="p">():</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-83'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-83">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">frame</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s">&#39;types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-84'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-84">#</a>
        </div>
        <p></pre>Specifies signatures of the adapter.</p>
<p>The component matches any of the specified signatures as well
all more specific signatures.</p>
<p>Use it in the namespace of the adapter, for example::</p>
<pre>class DoSmth(Adapter):
</pre>

<pre>adapts_many((T11, T12, ...),
(T21, T22, ...),
...)
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">def</span> <span class="nf">adapts_many</span><span class="p">(</span><span class="o">*</span><span class="n">type_vectors</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-85'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-85">#</a>
        </div>
        <p>Normalize the given type vectors.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">type_vectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">type_vector</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_vector</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
                                <span class="k">else</span> <span class="p">(</span><span class="n">type_vector</span><span class="p">,)</span>
                  <span class="k">for</span> <span class="n">type_vector</span> <span class="ow">in</span> <span class="n">type_vectors</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_vectors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">arity</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">type_vector</span><span class="p">)</span> <span class="o">==</span> <span class="n">arity</span>
               <span class="k">for</span> <span class="n">type_vector</span> <span class="ow">in</span> <span class="n">type_vectors</span><span class="p">)</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s">&#39;types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_vectors</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s">&#39;arity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arity</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-86'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-86">#</a>
        </div>
        <p></pre>Implements protocol interfaces.</p>
<p>A protocol interface provides mechanism for name-based dispatch.</p>
<p>This is an abstract class; to declare a protocol interface, create
a subclass of :class:<code>Protocol</code>.</p>
<p>To add an implementation of a protocol interface, create a subclass
of the interface class and specify its name using function :func:<code>named</code>.</p>
<p>Class attributes:</p>
<p><code>names</code> (a list of strings)
<pre>List of names that the component matches.
</pre>
The following example declares a protocol interface <code>Weigh</code>
and adds several implementations::</p>
<p>class Weigh(Protocol):
<pre>def <strong>init</strong>(self, name):
self.name = name
def <strong>call</strong>(self):</p>
<h1>The default implementation.</h1>
<p>return -1
</pre>
class WeighAlice(Weigh):
named("Alice")
def <strong>call</strong>(self):
return 150</p>
<p>class WeighBob(Weigh):
named("Bob")
def <strong>call</strong>(self):
return 160</p>
<p>def weigh(name):
weigh = Weigh(name)
return weigh()</p>
<blockquote>
<blockquote>
<blockquote>
<p>weigh("Alice")
150
weigh("Bob")
160
weigh("Clark")
-1</p>
</blockquote>
</blockquote>
</blockquote>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Protocol</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-87'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-87">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-88'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-88">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-89'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-89">#</a>
        </div>
        <p>The first argument of the constructor is the protocol name.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="n">name</span>

    <span class="nd">@classmethod</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-90'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-90">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">matches</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">dispatch_key</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-91'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-91">#</a>
        </div>
        <p>The dispatch key is the protocol name.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dispatch_key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">dispatch_key</span> <span class="ow">in</span> <span class="n">component</span><span class="o">.</span><span class="n">names</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-92'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-92">#</a>
        </div>
        <p>Specifies the names of the protocol.</p>
<p>Use it in the namespace of the protocol, for example::</p>
<pre>class DoSmth(Protocol):
</pre>

<pre>named("...")
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">def</span> <span class="nf">named</span><span class="p">(</span><span class="o">*</span><span class="n">names</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-93'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-93">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">frame</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s">&#39;names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-94'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-94">#</a>
        </div>
        <p></pre>Contains cached components and realizations.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">ComponentRegistry</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-95'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-95">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-96'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-96">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-97'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-97">#</a>
        </div>
        <p>List of active components (populated by <code>Component.component()</code>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="bp">None</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-98'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-98">#</a>
        </div>
        <p>A mapping: interface -&gt; [components]  (populated by
<code>Component.implementations()</code>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">implementations</span> <span class="o">=</span> <span class="p">{}</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-99'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-99">#</a>
        </div>
        <p>A mapping: (interface, dispatch_key) -&gt; realization (populated by
<code>Component.realize()</code>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">realizations</span> <span class="o">=</span> <span class="p">{}</span>

</pre></div></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
