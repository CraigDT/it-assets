<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>validator.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>validator.py</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-0'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-0">#</a>
        </div>
        <p>Copyright (c) 2006-2011, Prometheus Research, LLC
See <code>LICENSE</code> for license information, <code>AUTHORS</code> for the list of authors.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-1'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-1">#</a>
        </div>
        <h1>:mod:<code>htsql.validator</code></h1>
<p>This module provides utilities for data validation and conversion.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="kn">from</span> <span class="nn">util</span> <span class="kn">import</span> <span class="n">DB</span><span class="p">,</span> <span class="n">maybe</span><span class="p">,</span> <span class="n">oneof</span><span class="p">,</span> <span class="n">listof</span><span class="p">,</span> <span class="n">tupleof</span><span class="p">,</span> <span class="n">dictof</span>
<span class="kn">import</span> <span class="nn">re</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-2'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-2">#</a>
        </div>
        <p>Validators check if a given value conforms the specified format.</p>
<p>A validator acts as function that takes a value, checks if it conforms
the format, normalizes and returns the value.  Example::</p>
<pre>validator = IntVal()
value = validator(value)
</pre>

<p>If the value does not conform the format, :exc:<code>ValueError</code> is raised.</p>
<p>Attribute <code>hint</code> gives a short textual description of the format.</p>
<p>:class:<code>Validator</code> is the base abstract class for validators.  Its
subclasses provide validators for specific formats.</p>
<p>To create a validator for a new format, create a subclass of
:class:<code>Validator</code> and override the :meth:<code>__call__()</code> method.  The
method should accept values of any type.  If the value does not conform
to the format, :exc:<code>ValueError</code> should be raised; otherwise the value
should be normalized and returned.</p>
<p>Example::</p>
<p>class IntVal(Validator):</p>
<pre>hint = "an integer"
</pre>

<p>def <strong>call</strong>(self, value):
<pre>if isinstance(value, str):
value = int(value)
if not isinstance(value, int):
raise ValueError("an integer is expected")
return value</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Validator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-3'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-3">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">hint</span> <span class="o">=</span> <span class="bp">None</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-4'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-4">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-5'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-5">#</a>
        </div>
        <p>Override when subclassing.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-6'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-6">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_hint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-7'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-7">#</a>
        </div>
        <p>Override when the hint is not static.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hint</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-8'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-8">#</a>
        </div>
        <p></pre>A no-op validator.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">AnyVal</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-9'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-9">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">hint</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;an arbitrary value&quot;&quot;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-10'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-10">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-11'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-11">#</a>
        </div>
        <p>All values are passed through.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="n">value</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-12'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-12">#</a>
        </div>
        <p>Verifies if the value is a UTF-8 encoded string.</p>
<p><code>pattern</code> (a regular expression or <code>None</code>)
<pre>Checks if the string matches the given regular expression.
</pre>
<code>is_nullable</code> (Boolean)
If set, <code>None</code> values are permitted.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">StrVal</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-13'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-13">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">hint</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;a string&quot;&quot;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-14'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-14">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">is_nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-15'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-15">#</a>
        </div>
        <p>Sanity check on the arguments.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">maybe</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_nullable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span> <span class="o">=</span> <span class="n">is_nullable</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-16'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-16">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-17'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-17">#</a>
        </div>
        <p><code>None</code> is allowed if the <code>is_nullable</code> flag is set.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;the null value is not permitted&quot;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-18'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-18">#</a>
        </div>
        <p>A byte or a Unicode string is expected.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;a string value is expected; got </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-19'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-19">#</a>
        </div>
        <p>Byte strings must be UTF-8 encoded.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;unable to decode </span><span class="si">%r</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-20'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-20">#</a>
        </div>
        <p>Translate Unicode strings to UTF-8 encoded byte strings.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-21'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-21">#</a>
        </div>
        <p>Verify that the value does not contain the NUL character.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;NUL character is not allowed; got </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-22'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-22">#</a>
        </div>
        <p>Check if the value matches the pattern.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">regexp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%r</span><span class="s"> does not match pattern </span><span class="si">%r</span><span class="s">&quot;</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-23'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-23">#</a>
        </div>
        <p>We are done, return a string.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-24'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-24">#</a>
        </div>
        <p>Verifies if the value is a word.</p>
<p>A word is a string containing alphanumeric characters, dashes,
underscores, or spaces.  In the normalized form, underscores and
spaces are replaced with dashes.</p>
<p><code>is_nullable</code> (Boolean)
<pre>If set, <code>None</code> values are permitted.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">WordVal</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-25'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-25">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">hint</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;a word&quot;&quot;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-26'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-26">#</a>
        </div>
        <p>A regular expression for matching words.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">regexp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^[0-9a-zA-Z_ -]+$&#39;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-27'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-27">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-28'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-28">#</a>
        </div>
        <p>Sanity check on the arguments.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_nullable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span> <span class="o">=</span> <span class="n">is_nullable</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-29'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-29">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-30'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-30">#</a>
        </div>
        <p><code>None</code> is allowed if the <code>is_nullable</code> flag is set.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;the null value is not permitted&quot;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-31'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-31">#</a>
        </div>
        <p>A byte or a Unicode string is expected.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;a string value is expected; got </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-32'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-32">#</a>
        </div>
        <p>Byte strings must be UTF-8 encoded.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;unable to decode </span><span class="si">%r</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-33'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-33">#</a>
        </div>
        <p>Translate Unicode strings to UTF-8 encoded byte strings.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-34'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-34">#</a>
        </div>
        <p>Check if the string matches the word pattern.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;a string containing alphanumeric characters,&quot;</span>
                             <span class="s">&quot; dashes, underscores or spaces is expected;&quot;</span>
                             <span class="s">&quot; got </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-35'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-35">#</a>
        </div>
        <p>Normalize and return the value.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-36'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-36">#</a>
        </div>
        <p></pre>Verifies if the value belongs to a specified set of string constants.</p>
<p><code>choices</code> (a list of strings)
<pre>List of valid choices.
</pre>
<code>is_nullable</code> (Boolean)
If set, <code>None</code> values are permitted.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">ChoiceVal</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-37'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-37">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">hint</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;a choice (</span><span class="si">%s</span><span class="s">)&quot;&quot;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-38'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-38">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">choices</span><span class="p">,</span> <span class="n">is_nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-39'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-39">#</a>
        </div>
        <p>Sanity check on the arguments.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">choices</span><span class="p">,</span> <span class="n">listof</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_nullable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span> <span class="o">=</span> <span class="n">is_nullable</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-40'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-40">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-41'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-41">#</a>
        </div>
        <p><code>None</code> is allowed if the <code>is_nullable</code> flag is set.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;the null value is not permitted&quot;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-42'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-42">#</a>
        </div>
        <p>A byte or a Unicode string is expected.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;a string value is expected; got </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-43'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-43">#</a>
        </div>
        <p>Translate Unicode strings to UTF-8 encoded byte strings.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-44'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-44">#</a>
        </div>
        <p>Check if the value belongs to the specified set of choices.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
            <span class="n">choice_list</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;one of </span><span class="si">%s</span><span class="s"> expected; got </span><span class="si">%r</span><span class="s">&quot;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">choice_list</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">value</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-45'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-45">#</a>
        </div>
        <p>Verifies if the value is Boolean.</p>
<p>Besides <code>True</code> and <code>False</code> constants, the following values
are accepted:</p>
<ul>
<li><code>1</code>, <code>'1'</code>, <code>'true'</code> (as <code>True</code>);</li>
<li><code>0</code>, <code>''</code>, <code>'0'</code>, <code>'false'</code> (as <code>False</code>).</li>
</ul>
<p><code>is_nullable</code> (Boolean)
<pre>If set, <code>None</code> values are permitted.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BoolVal</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-46'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-46">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">hint</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;a Boolean value&quot;&quot;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-47'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-47">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-48'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-48">#</a>
        </div>
        <p>Sanity check on the arguments.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_nullable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span> <span class="o">=</span> <span class="n">is_nullable</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-49'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-49">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-50'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-50">#</a>
        </div>
        <p><code>None</code> is allowed if the <code>is_nullable</code> flag is set.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;the null value is not permitted&quot;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-51'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-51">#</a>
        </div>
        <p>Valid values are: False, True, 0, 1, '', '0', '1', 'false', 'true';
anything else triggers an exception.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="s">&#39;false&#39;</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;true&#39;</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;a Boolean value is expected; got </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-52'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-52">#</a>
        </div>
        <p>The value must be Boolean here.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-53'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-53">#</a>
        </div>
        <p></pre>Verifies if the value is an integer.</p>
<p>Strings containing numeric characters are also accepted.</p>
<p><code>min_bound</code> (integer or <code>None</code>)
<pre>If set, check that the value is greater or equal to <code>min_bound</code>.
</pre>
<code>max_bound</code> (integer or <code>None</code>)
If set, check that the value is less or equal to <code>max_bound</code>.</p>
<p><code>is_nullable</code> (Boolean)
If set, <code>None</code> values are permitted.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">IntVal</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-54'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-54">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">hint</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;an integer&quot;&quot;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-55'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-55">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_bound</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_bound</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">is_nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-56'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-56">#</a>
        </div>
        <p>Sanity check on the arguments.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_bound</span><span class="p">,</span> <span class="n">maybe</span><span class="p">(</span><span class="n">oneof</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_bound</span><span class="p">,</span> <span class="n">maybe</span><span class="p">(</span><span class="n">oneof</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_nullable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span> <span class="o">=</span> <span class="n">min_bound</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span> <span class="o">=</span> <span class="n">max_bound</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span> <span class="o">=</span> <span class="n">is_nullable</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-57'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-57">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-58'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-58">#</a>
        </div>
        <p><code>None</code> is allowed if the <code>is_nullable</code> flag is set.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;the null value is not permitted&quot;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-59'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-59">#</a>
        </div>
        <p>Convert string values; a non-numeric string triggers <code>ValueError</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;an integer value is required; got </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-60'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-60">#</a>
        </div>
        <p>Check the boundary conditions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;a value greater or equal to </span><span class="si">%s</span><span class="s"> is required;&quot;</span>
                             <span class="s">&quot; got </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;a value less or equal to </span><span class="si">%s</span><span class="s"> is required;&quot;</span>
                             <span class="s">&quot; got </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-61'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-61">#</a>
        </div>
        <p><code>value</code> is an integer or a long integer here.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">value</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-62'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-62">#</a>
        </div>
        <p>Verifies if the value is a non-negative integer.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">UIntVal</span><span class="p">(</span><span class="n">IntVal</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-63'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-63">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">hint</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;a non-negative integer&quot;&quot;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-64'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-64">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_bound</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">is_nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">UIntVal</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_bound</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-65'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-65">#</a>
        </div>
        <p>Verifies if the value is a positive integer.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">PIntVal</span><span class="p">(</span><span class="n">IntVal</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-66'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-66">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">hint</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;a positive integer&quot;&quot;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-67'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-67">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_bound</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">is_nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PIntVal</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_bound</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-68'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-68">#</a>
        </div>
        <p>Verifies if the value is an integer.</p>
<p>Strings representing numeric values in a decimal or a scientific format
are also accepted.</p>
<p><code>min_bound</code> (float or <code>None</code>)
<pre>If set, check that the value is greater or equal to <code>min_bound</code>.
</pre>
<code>max_bound</code> (float or <code>None</code>)
If set, check that the value is less or equal to <code>max_bound</code>.</p>
<p><code>is_nullable</code> (Boolean)
If set, <code>None</code> values are permitted.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">FloatVal</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-69'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-69">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">hint</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;a float number&quot;&quot;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-70'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-70">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_bound</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_bound</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">is_nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-71'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-71">#</a>
        </div>
        <p>Sanity check on the arguments.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_bound</span><span class="p">,</span> <span class="n">maybe</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_bound</span><span class="p">,</span> <span class="n">maybe</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_nullable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span> <span class="o">=</span> <span class="n">min_bound</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span> <span class="o">=</span> <span class="n">max_bound</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span> <span class="o">=</span> <span class="n">is_nullable</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-72'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-72">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-73'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-73">#</a>
        </div>
        <p><code>None</code> is allowed if the <code>is_nullable</code> flag is set.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;the null value is not permitted&quot;</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-74'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-74">#</a>
        </div>
        <p>Convert string and integer values.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;a float value is required; got </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-75'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-75">#</a>
        </div>
        <p>Check the boundary conditions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;a value greater or equal to </span><span class="si">%s</span><span class="s"> is required;&quot;</span>
                             <span class="s">&quot; got </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;a value less or equal to </span><span class="si">%s</span><span class="s"> is required;&quot;</span>
                             <span class="s">&quot; got </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-76'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-76">#</a>
        </div>
        <p><code>value</code> is a float number here.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-77'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-77">#</a>
        </div>
        <p>Verifies if the value is a non-negative float number.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">UFloatVal</span><span class="p">(</span><span class="n">IntVal</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-78'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-78">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">hint</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;a non-negative float number&quot;&quot;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-79'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-79">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_bound</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">is_nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">UFloatVal</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_bound</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-80'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-80">#</a>
        </div>
        <p>Verifies if the value is a list with each list item conforming
the specified format.</p>
<p>Also accepted are strings that agree with the following grammar::</p>
<pre>value ::= <empty> | item ( [,] value )*
item  ::= <any non-space character or comma>+
| ['] ( <any non-quote character> | [']['] )* [']
</pre>

<p>That is, the string must represent a comma-separated list of elements.
If an element contains no whitespace characters and no commas, it could
be represented literally; otherwise it should be quited with <code>'</code> and
any single quote character should be duplicated.</p>
<p><code>item_validator</code> (:class:<code>Validator</code>)
Validator for the sequence elements.</p>
<p><code>length</code> (an integer or <code>None</code>)
If set, check that the length of the sequence is equal to <code>length</code>.</p>
<p><code>is_nullable</code> (Boolean)
If set, <code>None</code> values are permitted.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">SeqVal</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-81'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-81">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">hint</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;a sequence [</span><span class="si">%s</span><span class="s">]&quot;&quot;&quot;</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-82'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-82">#</a>
        </div>
        <p>A regular expression to match tokens when the sequence is represented
by a string.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">pattern</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;</span>
<span class="s">        (?P&lt;space&gt; \s+ ) |</span>
<span class="s">        (?P&lt;comma&gt; , ) |</span>
<span class="s">        (?P&lt;item&gt; [^ \t\r\n&#39;,]+ | &#39; (?: [^&#39;] | &#39;&#39;)* &#39; )</span>
<span class="s">#DIVIDER</span>
<span class="s">    Verifies if the value is a dictionary with keys and items conforming</span>
<span class="s">    the specified formats.</span>

<span class="s">    Also accepted are strings that agree with the following grammar::</span>

<span class="s">        value     ::= &lt;empty&gt; | key ( [:] | [=] ) item ( [,] value )*</span>
<span class="s">        key, item ::= &lt;any non-space character except for [:], [=] or [,]&gt;+</span>
<span class="s">                    | [&#39;] ( &lt;any non-quote character&gt; | [&#39;][&#39;] )* [&#39;]</span>

<span class="s">    That is, the string must represent a comma-separated list of ``key=item``</span>
<span class="s">    pairs.  The key and the item could be quoted or unquoted.  An unquoted</span>
<span class="s">    element contains no whitespace, ``:``, ``=``, ``,`` characters.  A quoted</span>
<span class="s">    element is enclosed with ``&#39;`` and has any single quote character</span>
<span class="s">    duplicated.</span>

<span class="s">    `key_validator` (:class:`Validator`)</span>
<span class="s">        Validator for the mapping keys.</span>

<span class="s">    `item_validator` (:class:`Validator`)</span>
<span class="s">        Validator for the mapping values.</span>

<span class="s">    `is_nullable` (Boolean)</span>
<span class="s">        If set, ``None`` values are permitted.</span>
<span class="s">#DIVIDER</span>
<span class="s">    regexp = re.compile(pattern, re.X)</span>


<span class="s">#DIVIDER</span>
<span class="s">    def __init__(self, key_validator, item_validator, is_nullable=False):</span>

<span class="s">#DIVIDER</span>
<span class="s">        assert isinstance(key_validator, Validator)</span>
<span class="s">        assert isinstance(item_validator, Validator)</span>
<span class="s">        assert isinstance(is_nullable, bool)</span>

<span class="s">        self.key_validator = key_validator</span>
<span class="s">        self.item_validator = item_validator</span>
<span class="s">        self.is_nullable = is_nullable</span>


<span class="s">#DIVIDER</span>
<span class="s">    def get_hint(self):</span>

<span class="s">#DIVIDER</span>
<span class="s">        key_hint = self.key_validator.get_hint()</span>
<span class="s">        item_hint = self.item_validator.get_hint()</span>
<span class="s">        return self.hint % (key_hint, item_hint)</span>


<span class="s">#DIVIDER</span>
<span class="s">    def __call__(self, value):</span>

<span class="s">#DIVIDER</span>
<span class="s">        if value is None:</span>
<span class="s">            if self.is_nullable:</span>
<span class="s">                return None</span>
<span class="s">            else:</span>
<span class="s">                raise ValueError(&quot;the null value is not permitted&quot;)</span>


<span class="s">#DIVIDER</span>
<span class="s">        if isinstance(value, unicode):</span>
<span class="s">            value = value.encode(&#39;utf-8&#39;)</span>


<span class="s">#DIVIDER</span>
<span class="s">        if isinstance(value, str):</span>


<span class="s">#DIVIDER</span>
<span class="s">            pairs = []</span>

<span class="s">#DIVIDER</span>
<span class="s">            start = 0</span>

<span class="s">#DIVIDER</span>
<span class="s">            is_key_expected = True</span>
<span class="s">            is_colon_expected = False</span>
<span class="s">            is_item_expected = False</span>
<span class="s">            is_comma_expected = False</span>

<span class="s">#DIVIDER</span>
<span class="s">            current_key = None</span>


<span class="s">#DIVIDER</span>
<span class="s">            while start &lt; len(value):</span>

<span class="s">#DIVIDER</span>
<span class="s">                match = self.regexp.match(value, start)</span>
<span class="s">                if match is None:</span>
<span class="s">                    break</span>

<span class="s">#DIVIDER</span>
<span class="s">                if match.group(&#39;item&#39;) is not None:</span>
<span class="s">                    item = match.group(&#39;item&#39;)</span>
<span class="s">                    if item[0] == item[-1] == &#39;\&#39;&#39;:</span>
<span class="s">                        item = item[1:-1].replace(&#39;\&#39;\&#39;&#39;, &#39;\&#39;&#39;)</span>
<span class="s">                    if is_key_expected:</span>
<span class="s">                        current_key = item</span>
<span class="s">                        is_key_expected = False</span>
<span class="s">                        is_colon_expected = True</span>
<span class="s">                    elif is_item_expected:</span>
<span class="s">                        pairs.append((current_key, item))</span>
<span class="s">                        current_key = None</span>
<span class="s">                        is_item_expected = False</span>
<span class="s">                        is_comma_expected = True</span>
<span class="s">                    else:</span>
<span class="s">                        break</span>
<span class="s">                elif match.group(&#39;colon&#39;) is not None:</span>
<span class="s">                    if not is_colon_expected:</span>
<span class="s">                        break</span>
<span class="s">                    is_colon_expected = False</span>
<span class="s">                    is_item_expected = True</span>
<span class="s">                elif match.group(&#39;comma&#39;) is not None:</span>
<span class="s">                    if not is_comma_expected:</span>
<span class="s">                        break</span>
<span class="s">                    is_comma_expected = False</span>
<span class="s">                    is_key_expected = True</span>

<span class="s">#DIVIDER</span>
<span class="s">                start = match.end()</span>


<span class="s">#DIVIDER</span>
<span class="s">            if start &lt; len(value) or is_colon_expected or is_item_expected:</span>
<span class="s">                raise ValueError(&quot;a comma-separated list of key=value pairs&quot;</span>
<span class="s">                                 &quot; is expected; got </span><span class="si">%r</span><span class="s">&quot; % value)</span>


<span class="s">#DIVIDER</span>
<span class="s">            value = dict(pairs)</span>


<span class="s">#DIVIDER</span>
<span class="s">        if not isinstance(value, dict):</span>
<span class="s">            raise ValueError(&quot;a dictionary is required; got </span><span class="si">%r</span><span class="s">&quot; % value)</span>


<span class="s">#DIVIDER</span>
<span class="s">        pairs = []</span>
<span class="s">        key_set = set()</span>
<span class="s">        for key in sorted(value):</span>
<span class="s">            try:</span>
<span class="s">                validated_key = self.key_validator(key)</span>
<span class="s">            except ValueError, exc:</span>
<span class="s">                raise ValueError(&quot;invalid mapping key (</span><span class="si">%s</span><span class="s">)&quot; </span><span class="si">% e</span><span class="s">xc)</span>
<span class="s">            if validated_key in key_set:</span>
<span class="s">                raise ValueError(&quot;duplicate mapping key </span><span class="si">%r</span><span class="s">&quot; % key)</span>
<span class="s">            key_set.add(validated_key)</span>
<span class="s">            item = value[key]</span>
<span class="s">            try:</span>
<span class="s">                validated_item = self.item_validator(item)</span>
<span class="s">            except ValueError, exc:</span>
<span class="s">                raise ValueError(&quot;invalid mapping item for key </span><span class="si">%r</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&quot;</span>
<span class="s">                                 % (key, item))</span>
<span class="s">            pairs.append((validated_key, validated_item))</span>
<span class="s">        value = dict(pairs)</span>


<span class="s">#DIVIDER</span>
<span class="s">        return value</span>



<span class="s">#DIVIDER</span>
<span class="s">class ExtensionVal(Validator):</span>

<span class="s">    pattern = r&quot;&quot;&quot;</span>
        <span class="p">(</span><span class="err">?</span><span class="n">P</span><span class="o">&lt;</span><span class="n">space</span><span class="o">&gt;</span> \<span class="n">s</span><span class="o">+</span> <span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="err">?</span><span class="n">P</span><span class="o">&lt;</span><span class="n">comma</span><span class="o">&gt;</span> <span class="p">,</span> <span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="err">?</span><span class="n">P</span><span class="o">&lt;</span><span class="n">colon</span><span class="o">&gt;</span> <span class="p">:</span> <span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="err">?</span><span class="n">P</span><span class="o">&lt;</span><span class="n">equal</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="err">?</span><span class="n">P</span><span class="o">&lt;</span><span class="n">item</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">^</span> \<span class="n">t</span>\<span class="n">r</span>\<span class="n">n</span><span class="s">&#39;,:=]+ | &#39;</span> <span class="p">(</span><span class="err">?</span><span class="p">:</span> <span class="p">[</span><span class="o">^</span><span class="s">&#39;] | &#39;&#39;)* &#39;</span> <span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-83'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-83">#</a>
        </div>
        <p>regexp = re.compile(pattern, re.X)</p>
<p>def <strong>init</strong>(self, item_validator, length=None, is_nullable=False):
<pre># Sanity check on the arguments.
assert isinstance(item_validator, Validator)
assert isinstance(length, maybe(int))
assert isinstance(is_nullable, bool)
</pre>
self.item_validator = item_validator
self.length = length
self.is_nullable = is_nullable</p>
<p>def get_hint(self):</p>
<h1>Provide short description of the form:</h1>
<h1>a sequence [{item hint}]</h1>
<p>item_hint = self.item_validator.get_hint()
return self.hint % item_hint</p>
<p>def <strong>call</strong>(self, value):</p>
<h1><code>None</code> is allowed if the <code>is_nullable</code> flag is set.</h1>
<p>if value is None:
<pre>if self.is_nullable:
return None
else:
raise ValueError("the null value is not permitted")
</pre></p>
<h1>Translate Unicode strings to UTF-8 byte strings.</h1>
<p>if isinstance(value, unicode):
value = value.encode('utf-8')</p>
<h1>If the value is a string, parse it and extract the elements.</h1>
<p>if isinstance(value, str):</p>
<h1>List of elements.</h1>
<p>items = []</p>
<h1>The beginning of the next token.</h1>
<p>start = 0</p>
<h1>The current parsing state.</h1>
<p>is_comma_expected = False</p>
<h1>Parse the string till it ends.  Error conditions are signalled</h1>
<h1>by ending the loop prematurely.</h1>
<p>while start &lt; len(value):</p>
<h1>Fetch the next token.</h1>
<p>match = self.regexp.match(value, start)
if match is None:
<pre>break</p>
<h1>A simple state machine.  The <code>is_comma_expected</code> variable</h1>
<h1>represents the machine state; the token type represents</h1>
<h1>conditions.  The transition table:</h1>
<h1>is_comma_expected is on:</h1>
<h1>token type is 'space' =&gt; no-op</h1>
<h1>token type is 'comma' =&gt; turn is_comma_expected off</h1>
<h1>token type is 'item'  =&gt; ERROR</h1>
<h1>is_comma_expected is off:</h1>
<h1>token type is 'space' =&gt; no-op</h1>
<h1>token type is 'comma' =&gt; ERROR</h1>
<h1>token type is 'item'  =&gt; extract the element,</h1>
<h1>turn is_comma_expected on</h1>
<p>if match.group('item') is not None:
if is_comma_expected:
break
item = match.group('item')
if item[0] == item[-1] == ''':
item = item[1:-1].replace('''', ''')
items.append(item)
is_comma_expected = True
elif match.group('comma') is not None:
if not is_comma_expected:
break
is_comma_expected = False</p>
<h1>Move to the beginning of the next token.</h1>
<p>start = match.end()
</pre></p>
<h1>If the loop ended prematurely, it must have been</h1>
<h1>a parsing error.</h1>
<p>if start &lt; len(value):
raise ValueError("a comma-separated list is expected;"
" got %r" % value)</p>
<h1>Now <code>value</code> is a list of elements.</h1>
<p>value = items</p>
<h1>By this step, <code>value</code> must be converted to a proper list.</h1>
<p>if not isinstance(value, list):
raise ValueError("a list is expected; got %r" % value)</p>
<h1>Check the length is specified.</h1>
<p>if self.length is not None:
if len(value) != self.length:
raise ValueError("a sequence of length %s is expected;"
" got %r" % (self.length, value))</p>
<h1>Validate and normalize the list elements.</h1>
<p>items = []
for idx, item in enumerate(value):
try:
item = self.item_validator(item)
except ValueError, exc:
raise ValueError("invalid sequence item"
" #%s (%s)" % (idx+1, exc))
items.append(item)
value = items</p>
<h1>Here <code>value</code> is a list of normalized elements.</h1>
<p>return value</p>
<p>class MapVal(Validator):</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">name_regexp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
    <span class="n">dotted_name_pattern</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;</span>
<span class="s">        ^</span>
<span class="s">        [a-zA-Z_-][0-9a-zA-Z_-]*</span>
<span class="s">        (?: \. [a-zA-Z_-][0-9a-zA-Z_-]* )*</span>
<span class="s">        $</span>
<span class="s">#DIVIDER</span>
<span class="s">    Verifies if the value is an instance of the specified class.</span>

<span class="s">    `class_type`</span>
<span class="s">        A class or a type object.</span>

<span class="s">    `is_nullable` (Boolean)</span>
<span class="s">        If set, ``None`` values are permitted.</span>
<span class="s">#DIVIDER</span>
<span class="s">    regexp = re.compile(pattern, re.X)</span>


<span class="s">#DIVIDER</span>
<span class="s">    def __init__(self, class_type, is_nullable=False):</span>

<span class="s">#DIVIDER</span>
<span class="s">        assert isinstance(class_type, type)</span>
<span class="s">        assert isinstance(is_nullable, bool)</span>

<span class="s">        self.class_type = class_type</span>
<span class="s">        self.is_nullable = is_nullable</span>


<span class="s">#DIVIDER</span>
<span class="s">    def get_hint(self):</span>

<span class="s">#DIVIDER</span>
<span class="s">        return self.hint </span><span class="si">% s</span><span class="s">elf.class_type.__name__</span>


<span class="s">#DIVIDER</span>
<span class="s">    def __call__(self, value):</span>

<span class="s">#DIVIDER</span>
<span class="s">        if value is None:</span>
<span class="s">            if self.is_nullable:</span>
<span class="s">                return None</span>
<span class="s">            else:</span>
<span class="s">                raise ValueError(&quot;the null value is not permitted&quot;)</span>


<span class="s">#DIVIDER</span>
<span class="s">        if isinstance(value, str):</span>
<span class="s">            if self.regexp.match(value) is None:</span>
<span class="s">                raise ValueError(&quot;a dotted name is expected, got </span><span class="si">%r</span><span class="s">&quot;</span>
<span class="s">                                 % value)</span>
<span class="s">            module_name, attribute_name = value.rsplit(&#39;.&#39;, 1)</span>
<span class="s">            try:</span>
<span class="s">                module = __import__(module_name, fromlist=[attribute_name])</span>
<span class="s">            except ImportError, exc:</span>
<span class="s">                raise ValueError(&quot;a module name is expected, got </span><span class="si">%r</span><span class="s">&quot;</span>
<span class="s">                                 % module_name)</span>
<span class="s">            try:</span>
<span class="s">                value = getattr(module, attribute_name)</span>
<span class="s">            except AttributeError, exc:</span>
<span class="s">                raise ValueError(&quot;an attribute of module </span><span class="si">%r</span><span class="s"> is expected,&quot;</span>
<span class="s">                                 &quot; got </span><span class="si">%r</span><span class="s">&quot; % (module_name, attribute_name))</span>


<span class="s">#DIVIDER</span>
<span class="s">        if not isinstance(value, self.class_type):</span>
<span class="s">            raise ValueError(&quot;an instance of </span><span class="si">%s</span><span class="s"> is expected; got </span><span class="si">%r</span><span class="s">&quot;</span>
<span class="s">                             % (self.class_type.__name__, value))</span>

<span class="s">        return value</span>



<span class="s">#DIVIDER</span>
<span class="s">class DBVal(Validator):</span>
<span class="s">#DIVIDER</span>

<span class="s">    hint = &quot;&quot;&quot;</span><span class="n">a</span> <span class="n">connection</span> <span class="n">URI</span><span class="s">&quot;&quot;&quot;</span>


<span class="s">#DIVIDER</span>
<span class="s">    def __init__(self, is_nullable=False):</span>

<span class="s">#DIVIDER</span>
<span class="s">        assert isinstance(is_nullable, bool)</span>

<span class="s">        self.is_nullable = is_nullable</span>


<span class="s">#DIVIDER</span>
<span class="s">    def __call__(self, value):</span>

<span class="s">#DIVIDER</span>
<span class="s">        if value is None:</span>
<span class="s">            if self.is_nullable:</span>
<span class="s">                return None</span>
<span class="s">            else:</span>
<span class="s">                raise ValueError(&quot;the null value is not permitted&quot;)</span>


<span class="s">#DIVIDER</span>
<span class="s">        return DB.parse(value)</span>

</pre></div></pre></div>
      </td>
    </tr><tr id='section-84'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-84">#</a>
        </div>
        <p>hint = """a mapping {%s -&gt; %s}"""</p>
<h1>A regular expression to match tokens when the mapping is represented</h1>
<h1>by a string.</h1>
<p>pattern = r"""
<pre>(?P<space> s+ ) |
(?P<comma> , ) |
(?P<colon> [:=] ) |
(?P<item> [^ trn',:]+ | ' (?: [^'] | '')* ' )</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-85'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-85">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-86'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-86">#</a>
        </div>
        <p>Sanity check on the arguments.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-87'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-87">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-88'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-88">#</a>
        </div>
        <p>Provide short description of the form:
  a mapping </p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-89'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-89">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-90'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-90">#</a>
        </div>
        <p><code>None</code> is allowed if the <code>is_nullable</code> flag is set.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-91'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-91">#</a>
        </div>
        <p>Translate Unicode strings to UTF-8 encoded byte strings.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-92'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-92">#</a>
        </div>
        <p>If the value is a string, parse it and extract the elements.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-93'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-93">#</a>
        </div>
        <p>List of <code>(key, item)</code> pairs.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-94'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-94">#</a>
        </div>
        <p>The beginning of the next token.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-95'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-95">#</a>
        </div>
        <p>The current parsing state.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-96'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-96">#</a>
        </div>
        <p>Keeps the current key till we extract the corresponding item.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-97'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-97">#</a>
        </div>
        <p>Parse the string till it ends.  Error conditions are signalled
by ending the loop prematurely.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-98'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-98">#</a>
        </div>
        <p>Fetch the next token.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-99'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-99">#</a>
        </div>
        <p>This loop represents a simple state machine.  The
<code>is_key/colon/item/comma_expected</code> variables keep the
current state; the token type represents conditions.
The transition table:
  state is 'key':
      token type is 'space' =&gt; no-op
      token type is 'colon' =&gt; ERROR
      token type is 'comma' =&gt; ERROR
      token type is 'item'  =&gt; extract the element
                               as the current key,
                               set state to 'colon'
  state is 'colon':
      token type is 'space' =&gt; no-op
      token type is 'colon' =&gt; set state to 'item'
      token type is 'comma' =&gt; ERROR
      token type is 'item'  =&gt; ERROR
  state is 'item':
      token type is 'space' =&gt; no-op
      token type is 'colon' =&gt; ERROR
      token type is 'comma' =&gt; ERROR
      token type is 'item'  =&gt; extract the element
                               as the item corresponding
                               to the current key,
                               set state to 'comma'
  state is 'comma':
      token type is 'space' =&gt; no-op
      token type is 'colon' =&gt; ERROR
      token type is 'comma' =&gt; set state to 'key'
      token type is 'item'  =&gt; ERROR
Note that the final state must be either 'comma' or 'key'.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-100'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-100">#</a>
        </div>
        <p>Move to the next token.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-101'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-101">#</a>
        </div>
        <p>Check if the parsing loop ended prematurely, or if the final
state is invalid.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-102'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-102">#</a>
        </div>
        <p>Now <code>value</code> is a dictionary.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-103'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-103">#</a>
        </div>
        <p>By this time, <code>value</code> must be a dictionary.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-104'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-104">#</a>
        </div>
        <p>Validate and normalize the mapping keys and values.  Note that
we need to check for duplicate keys since normalization may
convert two distinct keys to the same normalized key.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-105'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-105">#</a>
        </div>
        <p>Here <code>value</code> is a mapping with normalized keys and items.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-106'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-106">#</a>
        </div>
        <p>regexp = re.compile(pattern, re.X)
name_pattern = r"""
^
[a-zA-Z_-][0-9a-zA-Z_-]*
$</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-107'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-107">#</a>
        </div>
        <p></pre>dotted_name_regexp = re.compile(dotted_name_pattern, re.X)</p>
<p>def <strong>init</strong>(self, is_nullable=False):
<pre># Sanity check on the arguments.
assert isinstance(is_nullable, bool)
self.is_nullable = is_nullable
</pre>
def <strong>call</strong>(self, value):</p>
<h1><code>None</code> is allowed if the <code>is_nullable</code> flag is set.</h1>
<p>if value is None:
<pre>if self.is_nullable:
return None
else:
raise ValueError("the null value is not permitted")
</pre></p>
<h1>Translate Unicode strings to UTF-8 encoded byte strings.</h1>
<p>if isinstance(value, unicode):
value = value.encode('utf-8')</p>
<h1>If the value is a string, parse it and extract the elements.</h1>
<p>if isinstance(value, str):</p>
<h1>The dotted name of the section.</h1>
<p>section = None</p>
<h1>List of <code>(key, item)</code> pairs.</h1>
<p>pairs = []</p>
<h1>The beginning of the next token.</h1>
<p>start = 0</p>
<h1>The current parsing state.</h1>
<p>is_section_expected = True
is_key_expected = False
is_colon_expected = False
is_equal_expected = False
is_item_expected = False
is_comma_expected = False</p>
<h1>Keeps the current key till we extract the corresponding item.</h1>
<p>current_key = None</p>
<h1>Parse the string till it ends.  Error conditions are signalled</h1>
<h1>by ending the loop prematurely.</h1>
<p>while start &lt; len(value):</p>
<h1>Fetch the next token.</h1>
<p>match = self.regexp.match(value, start)
if match is None:
<pre>break</p>
<h1>This loop represents a simple state machine.  The</h1>
<h1><code>is_section/colon/key/equal/item/comma_expected</code> variables</h1>
<h1>keep the current state; the token type represents conditions.</h1>
<h1>The transition table:</h1>
<h1>state is 'section':</h1>
<h1>token type is 'space' =&gt; no-op</h1>
<h1>token type is 'colon' =&gt; ERROR</h1>
<h1>token type is 'equal' =&gt; ERROR</h1>
<h1>token type is 'comma' =&gt; ERROR</h1>
<h1>token type is 'item'  =&gt; extract the section name,</h1>
<h1>set state to 'colon'</h1>
<h1>token type is 'end'   =&gt; ERROR</h1>
<h1>state is 'key':</h1>
<h1>token type is 'space' =&gt; no-op</h1>
<h1>token type is 'colon' =&gt; ERROR</h1>
<h1>token type is 'equal' =&gt; ERROR</h1>
<h1>token type is 'comma' =&gt; ERROR</h1>
<h1>token type is 'item'  =&gt; extract the key,</h1>
<h1>set state to 'equal'</h1>
<h1>token type is 'end'   =&gt; DONE</h1>
<h1>state is 'colon':</h1>
<h1>token type is 'space' =&gt; no-op</h1>
<h1>token type is 'colon' =&gt; set state to 'key'</h1>
<h1>token type is 'equal' =&gt; ERROR</h1>
<h1>token type is 'comma' =&gt; ERROR</h1>
<h1>token type is 'item'  =&gt; ERROR</h1>
<h1>token type is 'end'   =&gt; DONE</h1>
<h1>state is 'equal':</h1>
<h1>token type is 'space' =&gt; no-op</h1>
<h1>token type is 'colon' =&gt; ERROR</h1>
<h1>token type is 'equal' =&gt; set state to 'value'</h1>
<h1>token type is 'comma' =&gt; ERROR</h1>
<h1>token type is 'item'  =&gt; ERROR</h1>
<h1>token type is 'end'   =&gt; ERROR</h1>
<h1>state is 'item':</h1>
<h1>token type is 'space' =&gt; no-op</h1>
<h1>token type is 'colon' =&gt; ERROR</h1>
<h1>token type is 'equal' =&gt; ERROR</h1>
<h1>token type is 'comma' =&gt; ERROR</h1>
<h1>token type is 'item'  =&gt; extract the element</h1>
<h1>as the item corresponding</h1>
<h1>to the current key,</h1>
<h1>set state to 'comma'</h1>
<h1>token type is 'end'   =&gt; ERROR</h1>
<h1>state is 'comma':</h1>
<h1>token type is 'space' =&gt; no-op</h1>
<h1>token type is 'colon' =&gt; ERROR</h1>
<h1>token type is 'equal' =&gt; ERROR</h1>
<h1>token type is 'comma' =&gt; set state to 'key'</h1>
<h1>token type is 'item'  =&gt; ERROR</h1>
<h1>token type is 'end'   =&gt; DONE</h1>
<h1>The final state must be 'colon', 'comma' or 'key'.</h1>
<p>if match.group('item') is not None:
item = match.group('item')
if item[0] == item[-1] == ''':
item = item[1:-1].replace('''', ''')
if is_section_expected:
section = item
is_section_expected = False
is_colon_expected = True
elif is_key_expected:
current_key = item
is_key_expected = False
is_equal_expected = True
elif is_item_expected:
pairs.append((current_key, item))
current_key = None
is_item_expected = False
is_comma_expected = True
else:
break
elif match.group('colon') is not None:
if not is_colon_expected:
break
is_colon_expected = False
is_key_expected = True
elif match.group('equal') is not None:
if not is_equal_expected:
break
is_equal_expected = False
is_item_expected = True
elif match.group('comma') is not None:
if not is_comma_expected:
break
is_comma_expected = False
is_key_expected = True</p>
<h1>Move to the next token.</h1>
<p>start = match.end()
</pre></p>
<h1>Check if the parsing loop ended prematurely, or if the final</h1>
<h1>state is invalid.</h1>
<p>if start &lt; len(value) or is_equal_expected or is_item_expected:
raise ValueError("a value of the form section:key=value,..."
" is expected; got %r" % value)</p>
<h1>Now <code>value</code> is a pair of the section and a dictionary of</h1>
<h1>key and value pairs.</h1>
<p>value = (section, dict(pairs))</p>
<h1>By this time <code>value</code> must be a pair of section name and a mapping</h1>
<h1>of parameters.</h1>
<p>if not isinstance(value, tupleof(str, dictof(str, object))):
raise ValueError("a pair of a section name and a dictionary"
" is expected; got %r" % value)</p>
<h1>Validate and normalize the section name and the mapping keys.</h1>
<h1>Note that we need to check for duplicate keys since normalization</h1>
<h1>may convert two distinct keys to the same normalized key.</h1>
<p>section, parameters = value
if not self.dotted_name_regexp.match(section):
raise ValueError("a dotted name is expected, got %r" % section)
pairs = []
key_set = set()
for key in sorted(parameters):
item = parameters[key]
if not self.name_regexp.match(key):
raise ValueError("a name is expected, got %r" % key)
key = key.replace('-', '_')
if key in key_set:
raise ValueError("duplicate mapping key %r" % key)
key_set.add(key)
pairs.append((key, item))
value = (section, dict(pairs))</p>
<h1>Here <code>value</code> is a pair of the extension name and a mapping of</h1>
<h1>parameters.</h1>
<p>return value</p>
<p>class ClassVal(Validator):</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-108'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-108">#</a>
        </div>
        <p>hint = """a class instance (%s)"""</p>
<p>pattern = r"""
<pre>^
[a-zA-Z_][0-9a-zA-Z_]<em>
(. [a-zA-Z_][0-9a-zA-Z_]</em>)+
$</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-109'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-109">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-110'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-110">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-111'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-111">#</a>
        </div>
        <p>Sanity check on the arguments.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-112'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-112">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-113'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-113">#</a>
        </div>
        <p>Provide short description of the form
  a class instance({class name})</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-114'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-114">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-115'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-115">#</a>
        </div>
        <p><code>None</code> is allowed if the <code>is_nullable</code> flag is set.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-116'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-116">#</a>
        </div>
        <p>If <code>value</code> is a string, it must have a form:
  <package>.<module>.<attribute></p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-117'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-117">#</a>
        </div>
        <p>Check if the value is an instance of the specified class.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-118'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-118">#</a>
        </div>
        <p></pre>Verifies if the value is a connection URI.</p>
<p>For description of the connection URI format, see
:meth:<code>htsql.util.DB.parse</code>.</p>
<p><code>is_nullable</code> (Boolean)
<pre>If set, <code>None</code> values are permitted.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-119'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-119">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-120'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-120">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-121'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-121">#</a>
        </div>
        <p>Sanity check on the arguments.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-122'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-122">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-123'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-123">#</a>
        </div>
        <p><code>None</code> is allowed if the <code>is_nullable</code> flag is set.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-124'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-124">#</a>
        </div>
        <p>The <code>DB</code> class provides its own conversion routine.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
