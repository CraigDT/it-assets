<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>stitch.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>stitch.py</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-0'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-0">#</a>
        </div>
        <p>Copyright (c) 2006-2011, Prometheus Research, LLC
See <code>LICENSE</code> for license information, <code>AUTHORS</code> for the list of authors.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-1'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-1">#</a>
        </div>
        <h1>:mod:<code>htsql.tr.stitch</code></h1>
<p>This module implements stitching utilities over flow nodes.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="kn">from</span> <span class="nn">..util</span> <span class="kn">import</span> <span class="n">maybe</span><span class="p">,</span> <span class="n">listof</span>
<span class="kn">from</span> <span class="nn">..adapter</span> <span class="kn">import</span> <span class="n">Adapter</span><span class="p">,</span> <span class="n">adapts</span><span class="p">,</span> <span class="n">adapts_many</span>
<span class="kn">from</span> <span class="nn">.error</span> <span class="kn">import</span> <span class="n">CompileError</span>
<span class="kn">from</span> <span class="nn">.syntax</span> <span class="kn">import</span> <span class="n">IdentifierSyntax</span>
<span class="kn">from</span> <span class="nn">.flow</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Flow</span><span class="p">,</span> <span class="n">RootFlow</span><span class="p">,</span> <span class="n">ScalarFlow</span><span class="p">,</span> <span class="n">TableFlow</span><span class="p">,</span>
                   <span class="n">DirectTableFlow</span><span class="p">,</span> <span class="n">FiberTableFlow</span><span class="p">,</span>
                   <span class="n">QuotientFlow</span><span class="p">,</span> <span class="n">ComplementFlow</span><span class="p">,</span> <span class="n">MonikerFlow</span><span class="p">,</span> <span class="n">ForkedFlow</span><span class="p">,</span>
                   <span class="n">LinkedFlow</span><span class="p">,</span> <span class="n">FilteredFlow</span><span class="p">,</span> <span class="n">OrderedFlow</span><span class="p">,</span>
                   <span class="n">ColumnUnit</span><span class="p">,</span> <span class="n">KernelUnit</span><span class="p">,</span> <span class="n">CoveringUnit</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.term</span> <span class="kn">import</span> <span class="n">Joint</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-2'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-2">#</a>
        </div>
        <p>Produces the ordering of the given flow.</p>
<p>Returns a list of pairs <code>(code, direction)</code>, where <code>code</code> is an instance
of :class:<code>htsql.tr.flow.Code</code> and <code>direction</code> is <code>+1</code> or <code>-1</code>.
This list uniquely identifies sorting order of the flow elements.</p>
<p>This is an interface adapter with a signature::</p>
<pre>Arrange: (Flow, bool, bool) -> [(Code, int), ...]
</pre>

<p>The adapter is polymorphic on the first argument.</p>
<p><code>flow</code> (:class:<code>htsql.tr.flow.Flow</code>)
The flow to order.</p>
<p><code>with_strong</code> (Boolean)
If set, include explicit flow ordering.</p>
<p><code>with_weak</code> (Boolean)
If set, include implicit flow ordering.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Arrange</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-3'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-3">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts</span><span class="p">(</span><span class="n">Flow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-4'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-4">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">with_strong</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_weak</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">Flow</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">with_strong</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">with_weak</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_strong</span> <span class="o">=</span> <span class="n">with_strong</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_weak</span> <span class="o">=</span> <span class="n">with_weak</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-5'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-5">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-6'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-6">#</a>
        </div>
        <p>The default implementation works for the root flow and non-axial
flows.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_strong</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_weak</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-7'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-7">#</a>
        </div>
        <p>Produces native units of the given flow.</p>
<p>This is an interface adapter with a singlature::</p>
<pre>Spread: Flow -> (Unit, ...)
</pre>

<p>Native units of the flow are units which are exported by any term
representing the flow.  Note that together with native units generated
by this adapter, a flow term should also export same units reparented
against an inflated flow.</p>
<p><code>flow</code> (:class:<code>htsql.tr.flow.Flow</code>)
The flow node to spread.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Spread</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-8'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-8">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts</span><span class="p">(</span><span class="n">Flow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-9'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-9">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">Flow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-10'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-10">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-11'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-11">#</a>
        </div>
        <p>If the flow is not axial, use the native units of the parental flow,
but reparent them to the given flow.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">is_axis</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">spread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">unit</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-12'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-12">#</a>
        </div>
        <p>Otherwise, do not produce any units; must be overriden for axial
flows with native units.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-13'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-13">#</a>
        </div>
        <p>Generates joints connecting two parallel flows.</p>
<p>This is an interface adapter with a singlature::</p>
<pre>Sew: Flow -> (Joint, ...)
</pre>

<p>The joints produced by the :class:<code>Sew</code> adapter could be used to
attach together two term nodes represending the same flow node.</p>
<p>Units in the joints always belong to an inflated flow.</p>
<p><code>flow</code> (:class:<code>htsql.tr.flow.Flow</code>)
The flow node to sew.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Sew</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-14'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-14">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts</span><span class="p">(</span><span class="n">Flow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-15'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-15">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">Flow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-16'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-16">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-17'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-17">#</a>
        </div>
        <p>Non-axial flows should use the joints of the closest axis.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">is_axis</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sew</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-18'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-18">#</a>
        </div>
        <p>The default implementation is suitable for scalar flows;
must be overriden for other axial flows.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="p">[]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-19'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-19">#</a>
        </div>
        <p>Generates joints connecting the given flow to its parent.</p>
<p>This is an interface adapter with a singlature::</p>
<pre>Tie: Flow -> (Joint, ...)
</pre>

<p>The joints produced by the :class:<code>Tie</code> adapter are used to attach
a term node representing the flow to a term node representing the
origin flow.</p>
<p>Units in the joints always belong to an inflated flow.</p>
<p><code>flow</code> (:class:<code>htsql.tr.flow.Flow</code>)
The flow node to sew.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Tie</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-20'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-20">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts</span><span class="p">(</span><span class="n">Flow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-21'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-21">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">Flow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-22'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-22">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-23'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-23">#</a>
        </div>
        <p>Non-axial flows should use the joints of the closest axis.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">is_axis</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-24'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-24">#</a>
        </div>
        <p>The default implementation is suitable for scalar flows;
must be overriden for other axial flows.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="p">[]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-25'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-25">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">ArrangeScalar</span><span class="p">(</span><span class="n">Arrange</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">ScalarFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-26'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-26">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-27'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-27">#</a>
        </div>
        <p>A scalar flow inherits its ordering from the parent flow.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="n">arrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">with_strong</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">with_strong</span><span class="p">,</span>
                                       <span class="n">with_weak</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">with_weak</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-28'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-28">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">ArrangeTable</span><span class="p">(</span><span class="n">Arrange</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">TableFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-29'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-29">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-30'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-30">#</a>
        </div>
        <p>A table flow complements the ordering of its parent with
implicit table ordering.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">arrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">,</span>
                                       <span class="n">with_strong</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">with_strong</span><span class="p">,</span>
                                       <span class="n">with_weak</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">with_weak</span><span class="p">):</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_weak</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-31'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-31">#</a>
        </div>
        <p>Augment the parent ordering with ordering by the primary key
of the table (but only if the cardinality of the flow grows).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">is_contracting</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-32'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-32">#</a>
        </div>
        <p>List of columns which provide the default table ordering.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-33'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-33">#</a>
        </div>
        <p>When possible, we take the columns from the primary key
of the table.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">table</span>
                <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">column_names</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span><span class="o">.</span><span class="n">origin_column_names</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-34'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-34">#</a>
        </div>
        <p>However when the primary key does not exist, we use columns
of the first unique key comprised of non-nullable columns.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">unique_keys</span><span class="p">:</span>
                        <span class="n">column_names</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">origin_column_names</span>
                        <span class="n">key_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
                                       <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">column</span><span class="o">.</span><span class="n">is_nullable</span>
                               <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">key_columns</span><span class="p">):</span>
                            <span class="n">columns</span> <span class="o">=</span> <span class="n">key_columns</span>
                            <span class="k">break</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-35'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-35">#</a>
        </div>
        <p>If neither the primary key nor unique keys with non-nullable
columns exist, we have one option left: sort by all columns
of the table.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="k">if</span> <span class="ow">not</span> <span class="n">columns</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-36'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-36">#</a>
        </div>
        <p>We assign the column units to the inflated flow: it makes
it easier to find and eliminate duplicates.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-37'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-37">#</a>
        </div>
        <p>Add weak table ordering.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-38'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-38">#</a>
        </div>
        <p>We need to associate the newly generated column unit
with some binding node.  We use the binding of the flow,
but in order to produce a better string representation,
we replace the associated syntax node with a new
identifier named after the column.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                    <span class="n">identifier</span> <span class="o">=</span> <span class="n">IdentifierSyntax</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">mark</span><span class="p">)</span>
                    <span class="n">binding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">binding</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">syntax</span><span class="o">=</span><span class="n">identifier</span><span class="p">)</span>
                    <span class="n">code</span> <span class="o">=</span> <span class="n">ColumnUnit</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">binding</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-39'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-39">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">SpreadTable</span><span class="p">(</span><span class="n">Spread</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">TableFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-40'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-40">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-41'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-41">#</a>
        </div>
        <p>A term representing a table flow exports all columns of the table.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">ColumnUnit</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-42'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-42">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">SewTable</span><span class="p">(</span><span class="n">Sew</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">TableFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-43'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-43">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-44'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-44">#</a>
        </div>
        <p>Connect a table axis to itself using the primary key of the table.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-45'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-45">#</a>
        </div>
        <p>The table entity.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">table</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-46'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-46">#</a>
        </div>
        <p>The columns that constitute the primary key (if we have one).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">connect_columns</span> <span class="o">=</span> <span class="bp">None</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-47'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-47">#</a>
        </div>
        <p>If the table has a primary key, extract the columns.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span><span class="o">.</span><span class="n">origin_column_names</span>
            <span class="n">connect_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-48'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-48">#</a>
        </div>
        <p>The table lacks a primary key, in this case, search for a unique
key which could replace it.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">connect_columns</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-49'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-49">#</a>
        </div>
        <p>Iterate over all unique keys of the table.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">unique_keys</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-50'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-50">#</a>
        </div>
        <p>Extract the columns of the key.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="n">column_names</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">origin_column_names</span>
                <span class="n">key_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-51'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-51">#</a>
        </div>
        <p>Check that no columns of the key are nullable,
in this case, they uniquely identify a row of the table,
and thus, could serve as the primary key.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">column</span><span class="o">.</span><span class="n">is_nullable</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">key_columns</span><span class="p">):</span>
                    <span class="n">connect_columns</span> <span class="o">=</span> <span class="n">key_columns</span>
                    <span class="k">break</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-52'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-52">#</a>
        </div>
        <p>No primary key, we don't have other choice but to report an error.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">connect_columns</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CompileError</span><span class="p">(</span><span class="s">&quot;unable to connect a table&quot;</span>
                               <span class="s">&quot; lacking a primary key&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">mark</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-53'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-53">#</a>
        </div>
        <p>Generate joints that represent a connection by the primary key.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">connect_columns</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">ColumnUnit</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">Joint</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-54'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-54">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">TieFiberTable</span><span class="p">(</span><span class="n">Tie</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">FiberTableFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-55'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-55">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-56'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-56">#</a>
        </div>
        <p>Generate a list of joints corresponding to a connection by
a foreign key.  Note that the left unit must belong to the base
of the term axis while the right unit belongs to the axis itself.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lcolumn</span><span class="p">,</span> <span class="n">rcolumn</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">join</span><span class="o">.</span><span class="n">origin_columns</span><span class="p">,</span>
                                    <span class="n">flow</span><span class="o">.</span><span class="n">join</span><span class="o">.</span><span class="n">target_columns</span><span class="p">):</span>
            <span class="n">lunit</span> <span class="o">=</span> <span class="n">ColumnUnit</span><span class="p">(</span><span class="n">lcolumn</span><span class="p">,</span> <span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
            <span class="n">runit</span> <span class="o">=</span> <span class="n">ColumnUnit</span><span class="p">(</span><span class="n">rcolumn</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">Joint</span><span class="p">(</span><span class="n">lunit</span><span class="p">,</span> <span class="n">runit</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-57'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-57">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">ArrangeQuotient</span><span class="p">(</span><span class="n">Arrange</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">QuotientFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-58'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-58">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-59'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-59">#</a>
        </div>
        <p>Start with the parent ordering.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">arrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">,</span>
                                       <span class="n">with_strong</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">with_strong</span><span class="p">,</span>
                                       <span class="n">with_weak</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">with_weak</span><span class="p">):</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-60'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-60">#</a>
        </div>
        <p>Augment the parent ordering with implicit ordering by
the kernel expressions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_weak</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-61'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-61">#</a>
        </div>
        <p>We use inflated flows for ordering units.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">kernels</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">KernelUnit</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-62'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-62">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">SpreadQuotient</span><span class="p">(</span><span class="n">Spread</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">QuotientFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-63'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-63">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-64'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-64">#</a>
        </div>
        <p>Expressions attaching the quotient to the parent flow.
We take a tie between the seed ground and its parent;
the left side of the tie belongs to the seed ground
and must be exported by any term representing the quotient.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">lunit</span><span class="p">,</span> <span class="n">runit</span> <span class="ow">in</span> <span class="n">tie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">ground</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">KernelUnit</span><span class="p">(</span><span class="n">runit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="p">,</span> <span class="n">runit</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-65'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-65">#</a>
        </div>
        <p>The kernel expressions of the quotient.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">kernels</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">KernelUnit</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-66'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-66">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">SewQuotient</span><span class="p">(</span><span class="n">Sew</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">QuotientFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-67'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-67">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-68'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-68">#</a>
        </div>
        <p>Use an inflated flow for joints.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-69'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-69">#</a>
        </div>
        <p>The ground base units attaching the quotient to
the parent flow.  FIXME: not needed when the parent
flow is also sewn.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">tie</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">ground</span><span class="p">):</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">KernelUnit</span><span class="p">(</span><span class="n">joint</span><span class="o">.</span><span class="n">rop</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">joint</span><span class="o">.</span><span class="n">rop</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">joint</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">lop</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">rop</span><span class="o">=</span><span class="n">op</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-70'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-70">#</a>
        </div>
        <p>The kernel expressions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">kernels</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">KernelUnit</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">Joint</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-71'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-71">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">TieQuotient</span><span class="p">(</span><span class="n">Tie</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">QuotientFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-72'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-72">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-73'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-73">#</a>
        </div>
        <p>Use an inflated flow for joints.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-74'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-74">#</a>
        </div>
        <p>Use the joints attaching the seed ground to its parent,
but wrap the ground units so they belong to the quotient flow.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">tie</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">ground</span><span class="p">):</span>
            <span class="n">rop</span> <span class="o">=</span> <span class="n">KernelUnit</span><span class="p">(</span><span class="n">joint</span><span class="o">.</span><span class="n">rop</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">joint</span><span class="o">.</span><span class="n">rop</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">joint</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">rop</span><span class="o">=</span><span class="n">rop</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-75'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-75">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">ArrangeCovering</span><span class="p">(</span><span class="n">Arrange</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-76'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-76">#</a>
        </div>
        <p>The implementation is shared by all covering flows.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">(</span><span class="n">ComplementFlow</span><span class="p">,</span> <span class="n">MonikerFlow</span><span class="p">,</span> <span class="n">ForkedFlow</span><span class="p">,</span> <span class="n">LinkedFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-77'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-77">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-78'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-78">#</a>
        </div>
        <p>Start with the parent ordering.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">arrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">,</span>
                                       <span class="n">with_strong</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">with_strong</span><span class="p">,</span>
                                       <span class="n">with_weak</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">with_weak</span><span class="p">):</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-79'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-79">#</a>
        </div>
        <p>Add ordering of the seed flow.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_weak</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-80'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-80">#</a>
        </div>
        <p>We use inflated flows for ordering.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-81'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-81">#</a>
        </div>
        <p>We use this flow to filter out expressions singular against
the parent flow; could be <code>None</code> (only for <code>ForkedFlow</code>
and <code>MonikerFlow</code>).  Note that we could have used
<code>self.flow.base</code> for all but <code>ForkedFlow</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">ground</span><span class="o">.</span><span class="n">base</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-82'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-82">#</a>
        </div>
        <p>Emit ordering of the seed, but ignore expressions
that are singular against the parent flow --
they cannot affect the ordering.
Note that both weak and strong ordering of the seed
become weak ordering of the covering flow.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">arrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">seed</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">base</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">base</span><span class="o">.</span><span class="n">spans</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">flow</span><span class="p">)</span>
                                       <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">code</span><span class="o">.</span><span class="n">units</span><span class="p">):</span>
                    <span class="n">code</span> <span class="o">=</span> <span class="n">CoveringUnit</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-83'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-83">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">SpreadCovering</span><span class="p">(</span><span class="n">Spread</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-84'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-84">#</a>
        </div>
        <p>The implementation is shared by all covering flows.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">(</span><span class="n">ComplementFlow</span><span class="p">,</span> <span class="n">MonikerFlow</span><span class="p">,</span> <span class="n">ForkedFlow</span><span class="p">,</span> <span class="n">LinkedFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-85'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-85">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-86'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-86">#</a>
        </div>
        <p>Native units of the complement are inherited from the seed flow.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-87'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-87">#</a>
        </div>
        <p>Use an inflated seed to reduce the number of variations.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">spread</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">unit</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-88'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-88">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">SewCovering</span><span class="p">(</span><span class="n">Sew</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-89'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-89">#</a>
        </div>
        <p>The implementation is shared by all covering flows.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">(</span><span class="n">ComplementFlow</span><span class="p">,</span> <span class="n">MonikerFlow</span><span class="p">,</span> <span class="n">LinkedFlow</span><span class="p">,</span> <span class="n">ForkedFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-90'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-90">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-91'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-91">#</a>
        </div>
        <p>To sew two terms representing a covering flow, we sew all axial flows
from the seed to the ground.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-92'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-92">#</a>
        </div>
        <p>Use an inflated flow for joints.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-93'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-93">#</a>
        </div>
        <p>The top axis.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-94'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-94">#</a>
        </div>
        <p>The last axis to use (for <code>ForkedFlow</code>, same as <code>seed</code>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">baseline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">ground</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-95'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-95">#</a>
        </div>
        <p>Gather all axes from the seed to the baseline.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="k">while</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">axis</span><span class="o">.</span><span class="n">concludes</span><span class="p">(</span><span class="n">baseline</span><span class="p">):</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">base</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-96'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-96">#</a>
        </div>
        <p>Start from the shortest axis.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">axes</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-97'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-97">#</a>
        </div>
        <p>Combine joints from all the axes.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-98'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-98">#</a>
        </div>
        <p>We can skip non-expanding axes, but must always
include the baseline.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">if</span> <span class="ow">not</span> <span class="n">axis</span><span class="o">.</span><span class="n">is_contracting</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="n">baseline</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-99'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-99">#</a>
        </div>
        <p>Wrap and emit the axis joints.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>                <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">sew</span><span class="p">(</span><span class="n">axis</span><span class="p">):</span>
                    <span class="n">op</span> <span class="o">=</span> <span class="n">CoveringUnit</span><span class="p">(</span><span class="n">joint</span><span class="o">.</span><span class="n">lop</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">joint</span><span class="o">.</span><span class="n">lop</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">joint</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">lop</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">rop</span><span class="o">=</span><span class="n">op</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-100'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-100">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">TieComplement</span><span class="p">(</span><span class="n">Tie</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">ComplementFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-101'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-101">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-102'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-102">#</a>
        </div>
        <p>Use an inflated flow for joints.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-103'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-103">#</a>
        </div>
        <p>Units attaching the seed ground to its parent.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">tie</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">ground</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-104'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-104">#</a>
        </div>
        <p>The ground base expression.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="n">op</span> <span class="o">=</span> <span class="n">joint</span><span class="o">.</span><span class="n">rop</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-105'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-105">#</a>
        </div>
        <p>The expression embedded in the quotient.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="n">lop</span> <span class="o">=</span> <span class="n">KernelUnit</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-106'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-106">#</a>
        </div>
        <p>The expression embedded in the complement.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="n">rop</span> <span class="o">=</span> <span class="n">CoveringUnit</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">joint</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">lop</span><span class="o">=</span><span class="n">lop</span><span class="p">,</span> <span class="n">rop</span><span class="o">=</span><span class="n">rop</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-107'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-107">#</a>
        </div>
        <p>The kernel expressions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">kernels</span><span class="p">:</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-108'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-108">#</a>
        </div>
        <p>The quotient kernel.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="n">lop</span> <span class="o">=</span> <span class="n">KernelUnit</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-109'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-109">#</a>
        </div>
        <p>The same kernel embedded in the complement space.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="n">rop</span> <span class="o">=</span> <span class="n">CoveringUnit</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">Joint</span><span class="p">(</span><span class="n">lop</span><span class="o">=</span><span class="n">lop</span><span class="p">,</span> <span class="n">rop</span><span class="o">=</span><span class="n">rop</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-110'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-110">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">TieMoniker</span><span class="p">(</span><span class="n">Tie</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">MonikerFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-111'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-111">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-112'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-112">#</a>
        </div>
        <p>Use an inflated flow for joints.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-113'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-113">#</a>
        </div>
        <p>Normally, use the serial joints of the seed ground, but if
the ground (as well as the flow itself) is singular against
the parent flow, use parallel joints.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">flow</span><span class="o">.</span><span class="n">is_contracting</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="n">sew</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">ground</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="n">tie</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">ground</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-114'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-114">#</a>
        </div>
        <p>Wrap the ground joints.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">joints</span><span class="p">:</span>
            <span class="n">rop</span> <span class="o">=</span> <span class="n">CoveringUnit</span><span class="p">(</span><span class="n">joint</span><span class="o">.</span><span class="n">rop</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">joint</span><span class="o">.</span><span class="n">rop</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">joint</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">rop</span><span class="o">=</span><span class="n">rop</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-115'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-115">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">TieForked</span><span class="p">(</span><span class="n">Tie</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">ForkedFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-116'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-116">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-117'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-117">#</a>
        </div>
        <p>Use an inflated flow for joints.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-118'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-118">#</a>
        </div>
        <p>Attach the seed ground to its parent.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">tie</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">seed</span><span class="p">):</span>
            <span class="n">lop</span> <span class="o">=</span> <span class="n">joint</span><span class="o">.</span><span class="n">rop</span>
            <span class="n">rop</span> <span class="o">=</span> <span class="n">CoveringUnit</span><span class="p">(</span><span class="n">lop</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">lop</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">joint</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">lop</span><span class="o">=</span><span class="n">lop</span><span class="p">,</span> <span class="n">rop</span><span class="o">=</span><span class="n">rop</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-119'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-119">#</a>
        </div>
        <p>Attach the seed to itself by the kernel expressions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">kernels</span><span class="p">:</span>
            <span class="n">lop</span> <span class="o">=</span> <span class="n">code</span>
            <span class="n">rop</span> <span class="o">=</span> <span class="n">CoveringUnit</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">Joint</span><span class="p">(</span><span class="n">lop</span><span class="p">,</span> <span class="n">rop</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-120'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-120">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">TieLinked</span><span class="p">(</span><span class="n">Tie</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">LinkedFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-121'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-121">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-122'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-122">#</a>
        </div>
        <p>Use an inflated flow for joints.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">inflate</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-123'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-123">#</a>
        </div>
        <p>Attach the seed to the base flow using the fiber conditions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">for</span> <span class="n">lop</span><span class="p">,</span> <span class="n">rop</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
            <span class="n">rop</span> <span class="o">=</span> <span class="n">CoveringUnit</span><span class="p">(</span><span class="n">rop</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">rop</span><span class="o">.</span><span class="n">binding</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">Joint</span><span class="p">(</span><span class="n">lop</span><span class="p">,</span> <span class="n">rop</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-124'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-124">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">ArrangeOrdered</span><span class="p">(</span><span class="n">Arrange</span><span class="p">):</span>

    <span class="n">adapts</span><span class="p">(</span><span class="n">OrderedFlow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-125'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-125">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-126'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-126">#</a>
        </div>
        <p>Start with strong ordering of the parent flow.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_strong</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">arrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">,</span>
                                           <span class="n">with_strong</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_weak</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-127'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-127">#</a>
        </div>
        <p>Emit the ordering specified by the node itself.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>            <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">direction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">order</span><span class="p">:</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-128'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-128">#</a>
        </div>
        <p>Conclude with weak ordering of the parent flow.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_weak</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">arrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">base</span><span class="p">,</span>
                                           <span class="n">with_strong</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">with_weak</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-129'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-129">#</a>
        </div>
        <p>Returns the ordering of the given flow.</p>
<p><code>flow</code> (:class:<code>htsql.tr.flow.Flow</code>)
<pre>The flow to order.
</pre>
<code>with_strong</code> (Boolean)
If set, include explicit flow ordering.</p>
<p><code>with_weak</code> (Boolean)
If set, include implicit flow ordering.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">def</span> <span class="nf">arrange</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">with_strong</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_weak</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-130'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-130">#</a>
        </div>
        <p>Realize an <code>Arrange</code> adapter.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">arrange</span> <span class="o">=</span> <span class="n">Arrange</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">with_strong</span><span class="p">,</span> <span class="n">with_weak</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-131'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-131">#</a>
        </div>
        <p>Invoke the adapter and convert the generated iterator to a list.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">arrange</span><span class="p">())</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-132'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-132">#</a>
        </div>
        <p>Returns native units of the given flow.</p>
<p>Na</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">def</span> <span class="nf">spread</span><span class="p">(</span><span class="n">flow</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-133'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-133">#</a>
        </div>
        <p>Realize a <code>Spread</code> adapter.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">spread</span> <span class="o">=</span> <span class="n">Spread</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-134'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-134">#</a>
        </div>
        <p>Invoke the adapter and convert the generated iterator to a list.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">spread</span><span class="p">())</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-135'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-135">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">def</span> <span class="nf">sew</span><span class="p">(</span><span class="n">flow</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-136'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-136">#</a>
        </div>
        <p>Realize a <code>Sew</code> adapter.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">sew</span> <span class="o">=</span> <span class="n">Sew</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-137'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-137">#</a>
        </div>
        <p>Invoke the adapter and convert the generated iterator to a list.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">sew</span><span class="p">())</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-138'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-138">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">def</span> <span class="nf">tie</span><span class="p">(</span><span class="n">flow</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-139'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-139">#</a>
        </div>
        <p>Realize a <code>Tie</code> adapter.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">tie</span> <span class="o">=</span> <span class="n">Tie</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-140'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-140">#</a>
        </div>
        <p>Invoke the adapter and convert the generated iterator to a list.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">tie</span><span class="p">())</span>

</pre></div></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
