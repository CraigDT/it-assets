<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>frame.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>frame.py</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-0'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-0">#</a>
        </div>
        <p>Copyright (c) 2006-2011, Prometheus Research, LLC
See <code>LICENSE</code> for license information, <code>AUTHORS</code> for the list of authors.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-1'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-1">#</a>
        </div>
        <h1>:mod:<code>htsql.tr.frame</code></h1>
<p>This module declares frame and phrase nodes.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="kn">from</span> <span class="nn">..util</span> <span class="kn">import</span> <span class="n">listof</span><span class="p">,</span> <span class="n">tupleof</span><span class="p">,</span> <span class="n">maybe</span><span class="p">,</span> <span class="n">Clonable</span><span class="p">,</span> <span class="n">Comparable</span><span class="p">,</span> <span class="n">Printable</span>
<span class="kn">from</span> <span class="nn">..entity</span> <span class="kn">import</span> <span class="n">TableEntity</span><span class="p">,</span> <span class="n">ColumnEntity</span>
<span class="kn">from</span> <span class="nn">..domain</span> <span class="kn">import</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">BooleanDomain</span>
<span class="kn">from</span> <span class="nn">.coerce</span> <span class="kn">import</span> <span class="nb">coerce</span>
<span class="kn">from</span> <span class="nn">.flow</span> <span class="kn">import</span> <span class="n">Expression</span>
<span class="kn">from</span> <span class="nn">.term</span> <span class="kn">import</span> <span class="n">Term</span><span class="p">,</span> <span class="n">QueryTerm</span>
<span class="kn">from</span> <span class="nn">.signature</span> <span class="kn">import</span> <span class="n">Signature</span><span class="p">,</span> <span class="n">Bag</span><span class="p">,</span> <span class="n">Formula</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-2'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-2">#</a>
        </div>
        <p>Represents a SQL clause.</p>
<p>This is an abstract class; its subclasses are divided into two categories:
frames (see :class:<code>Frame</code>) and phrases (see :class:<code>Phrase</code>).</p>
<p>A clause tree represents a SQL statement and is the next-to-last
structure of the HTSQL translator.  A clause tree is translated from
the term tree and the code graph by the <em>assembling</em> process.  It is then
translated to SQL by the <em>serializing</em> process.</p>
<p>The following adapters are associated with the assembling process and
generate new clause nodes::</p>
<pre>Assemble: (Term, AssemblingState) -> Frame
Evaluate: (Code, AssemblingState) -> Phrase
</pre>

<p>See :class:<code>htsql.tr.assemble.Assemble</code> and
:class:<code>htsql.tr.assemble.Evaluate</code> for more detail.</p>
<p>The following adapter is associated with the serializing process::</p>
<p>Dump: (Clause, DumpingState) -&gt; str</p>
<p>See :class:<code>htsql.tr.dump.Dump</code> for more detail.</p>
<p>Clause nodes support equality by value.</p>
<p>The constructor arguments:</p>
<p><code>expression</code> (:class:<code>htsql.tr.flow.Expression</code>)
The expression node that gave rise to the clause; for debugging
and error reporting only.</p>
<p><code>equality_vector</code> (an immutable tuple or <code>None</code>)
Encapsulates all essential attributes of a node.  Two clauses are
equal if and only if they are of the same type and their equality
vectors are equal.  If <code>None</code>, the clause is compared by identity.</p>
<p>Note that the <code>expression</code> attribute is not essential and should
not be a part of the equality vector.</p>
<p>Other attributes:</p>
<p><code>binding</code> (:class:<code>htsql.tr.binding.Binding</code>)
The binding node that gave rise to the expression; for debugging
purposes only.</p>
<p><code>syntax</code> (:class:<code>htsql.tr.syntax.Syntax</code>)
The syntax node that gave rise to the expression; for debugging
purposes only.</p>
<p><code>mark</code> (:class:<code>htsql.mark.Mark</code>)
The location of the node in the original query; for error reporting.</p>
<p><code>hash</code> (an integer)
The node hash; if two nodes are considered equal, their hashes
must be equal too.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Clause</span><span class="p">(</span><span class="n">Comparable</span><span class="p">,</span> <span class="n">Clonable</span><span class="p">,</span> <span class="n">Printable</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-3'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-3">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-4'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-4">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">equality_vector</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">Expression</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Clause</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">equality_vector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expression</span> <span class="o">=</span> <span class="n">expression</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binding</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">binding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syntax</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">syntax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mark</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">mark</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-5'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-5">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-6'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-6">#</a>
        </div>
        <p>Represents a SQL frame.</p>
<p>A <em>frame</em> is a node in the query tree, that is, one of these:</p>
<ul>
<li>a top level <code>SELECT</code> clause, the root of the tree;</li>
<li>a nested <code>SELECT</code> clause, a branch of the tree;</li>
<li>a table or a scalar (<code>DUAL</code>) clause, a leaf of the tree.</li>
</ul>
<p>:class:<code>Frame</code> is an abstract case class, see subclasses for concrete
frame types.</p>
<p>Each frame node has a unique (in the context of the whole tree) identifier
called the <em>tag</em>.  Tags are used to refer to frame nodes indirectly.</p>
<p>As opposed to phrases, frame nodes are always compared by identity.</p>
<p>Class attributes:</p>
<p><code>is_leaf</code> (Boolean)
<pre>Indicates that the frame is terminal (either a table or a scalar).
</pre>
<code>is_scalar</code> (Boolean)
Indicates that the frame is a scalar frame.</p>
<p><code>is_table</code> (Boolean)
Indicates that the frame is a table frame.</p>
<p><code>is_branch</code> (Boolean)
Indicates that the frame is non-terminal (either nested or a segment).</p>
<p><code>is_nested</code> (Boolean)
Indicates that the frame is a nested branch frame.</p>
<p><code>is_segment</code> (Boolean)
Indicates that the frame is the segment frame.</p>
<p>Constructor arguments:</p>
<p><code>kids</code> (a list of :class:<code>Frame</code>)
A list of child frames.</p>
<p><code>term</code> (:class:<code>htsql.tr.term.Term</code>)
The term node that gave rise to the frame.</p>
<p>Other attributes:</p>
<p><code>tag</code> (an integer)
A unique identifier of the frame; inherited from the term.</p>
<p><code>flow</code> (:class:<code>htsql.tr.flow.Flow</code>)
The flow represented by the frame; inherited from the term.</p>
<p><code>baseline</code> (:class:<code>htsql.tr.flow.Flow</code>)
The baseline flow of the frame; inherited from the term.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Frame</span><span class="p">(</span><span class="n">Clause</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-7'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-7">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">is_leaf</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">is_scalar</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">is_table</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">is_branch</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">is_nested</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">is_segment</span> <span class="o">=</span> <span class="bp">False</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-8'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-8">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kids</span><span class="p">,</span> <span class="n">term</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-9'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-9">#</a>
        </div>
        <p>Sanity check on the arguments.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kids</span><span class="p">,</span> <span class="n">listof</span><span class="p">(</span><span class="n">Frame</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">Term</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Frame</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">expression</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kids</span> <span class="o">=</span> <span class="n">kids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">term</span> <span class="o">=</span> <span class="n">term</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-10'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-10">#</a>
        </div>
        <p>Extract semantically important attributes of the term.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">flow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">baseline</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-11'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-11">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">term</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-12'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-12">#</a>
        </div>
        <p>Represents a leaf frame.</p>
<p>This is an abstract class; for concrete subclasses, see
:class:<code>ScalarFrame</code> and :class:<code>TableFrame</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">LeafFrame</span><span class="p">(</span><span class="n">Frame</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-13'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-13">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">is_leaf</span> <span class="o">=</span> <span class="bp">True</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-14'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-14">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">term</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LeafFrame</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">([],</span> <span class="n">term</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-15'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-15">#</a>
        </div>
        <p>Represents a scalar frame.</p>
<p>In SQL, a scalar frame is embodied by a special one-row <code>DUAL</code> table.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">ScalarFrame</span><span class="p">(</span><span class="n">LeafFrame</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-16'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-16">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">is_scalar</span> <span class="o">=</span> <span class="bp">True</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-17'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-17">#</a>
        </div>
        <p>Represents a table frame.</p>
<p>In SQL, table frames are serialized as tables in the <code>FROM</code> list.</p>
<p><code>table</code> (:class:<code>htsql.entity.TableEntity</code>)
<pre>The table represented by the frame.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">TableFrame</span><span class="p">(</span><span class="n">LeafFrame</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-18'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-18">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">is_table</span> <span class="o">=</span> <span class="bp">True</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-19'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-19">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">term</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">TableEntity</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TableFrame</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-20'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-20">#</a>
        </div>
        <p></pre>Represents a branch frame.</p>
<p>This is an abstract class; for concrete subclasses, see
:class:<code>NestedFrame</code> and :class:<code>SegmentFrame</code>.</p>
<p>In SQL, a branch frame is serialized as a top level (segment)
or a nested <code>SELECT</code> statement.</p>
<p><code>include</code> (a list of :class:<code>Anchor</code>)
<pre>Represents the <code>FROM</code> clause.
</pre>
<code>embed</code> (a list of :class:<code>NestedFrame</code>)
Correlated subqueries that are used in the frame.</p>
<p>A correlated subquery is a sub-<code>SELECT</code> statement that appears
outside the <code>FROM</code> list.  The <code>embed</code> list keeps all correlated
subqueries that appear in the frame.  To refer to a correlated
subquery from a phrase, use :class:<code>EmbeddingPhrase</code>.</p>
<p><code>select</code> (a list of :class:<code>Phrase</code>)
Represents the <code>SELECT</code> clause.</p>
<p><code>where</code> (:class:<code>Phrase</code> or <code>None</code>)
Represents the <code>WHERE</code> clause.</p>
<p><code>group</code> (a list of :class:<code>Phrase</code>)
Represents the <code>GROUP BY</code> clause.</p>
<p><code>having</code> (:class:<code>Phrase</code> or <code>None</code>)
Represents the <code>HAVING</code> clause.</p>
<p><code>order</code> (a list of pairs <code>(phrase, direction)</code>)
Represents the <code>ORDER BY</code> clause.</p>
<p>Here <code>phrase</code> is a :class:<code>Phrase</code> instance, <code>direction</code>
is either <code>+1</code> (indicates ascending order) or <code>-1</code>
(indicates descending order).</p>
<p><code>limit</code> (a non-negative integer or <code>None</code>)
Represents the <code>LIMIT</code> clause.</p>
<p><code>offset</code> (a non-negative integer or <code>None</code>)
Represents the <code>OFFSET</code> clause.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BranchFrame</span><span class="p">(</span><span class="n">Frame</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-21'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-21">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">is_branch</span> <span class="o">=</span> <span class="bp">True</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-22'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-22">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">embed</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span>
                 <span class="n">where</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">having</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">term</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-23'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-23">#</a>
        </div>
        <p>Note that we do not require <code>include</code> list to be non-empty,
thus an instance of <code>BranchFrame</code> could actually be a leaf
in the frame tree!</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">include</span><span class="p">,</span> <span class="n">listof</span><span class="p">(</span><span class="n">Anchor</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-24'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-24">#</a>
        </div>
        <p>Check that the join condition on the first subframe is no-op.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="n">include</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">include</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">LeadingAnchor</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">embed</span><span class="p">,</span> <span class="n">listof</span><span class="p">(</span><span class="n">NestedFrame</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">select</span><span class="p">,</span> <span class="n">listof</span><span class="p">(</span><span class="n">Phrase</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">select</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">maybe</span><span class="p">(</span><span class="n">Phrase</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">listof</span><span class="p">(</span><span class="n">Phrase</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">having</span><span class="p">,</span> <span class="n">maybe</span><span class="p">(</span><span class="n">Phrase</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">listof</span><span class="p">(</span><span class="n">tupleof</span><span class="p">(</span><span class="n">Phrase</span><span class="p">,</span> <span class="nb">int</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="n">maybe</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">maybe</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">limit</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">limit</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">offset</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">offset</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="n">kids</span> <span class="o">=</span> <span class="p">[</span><span class="n">anchor</span><span class="o">.</span><span class="n">frame</span> <span class="k">for</span> <span class="n">anchor</span> <span class="ow">in</span> <span class="n">include</span><span class="p">]</span> <span class="o">+</span> <span class="n">embed</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BranchFrame</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">kids</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include</span> <span class="o">=</span> <span class="n">include</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">embed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span> <span class="o">=</span> <span class="n">select</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">where</span> <span class="o">=</span> <span class="n">where</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">having</span> <span class="o">=</span> <span class="n">having</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-25'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-25">#</a>
        </div>
        <p>Represents a nested <code>SELECT</code> statement.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">NestedFrame</span><span class="p">(</span><span class="n">BranchFrame</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-26'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-26">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">is_nested</span> <span class="o">=</span> <span class="bp">True</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-27'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-27">#</a>
        </div>
        <p>Represents a top-level <code>SELECT</code> statement.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">SegmentFrame</span><span class="p">(</span><span class="n">BranchFrame</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-28'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-28">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">is_segment</span> <span class="o">=</span> <span class="bp">True</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-29'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-29">#</a>
        </div>
        <p>Represents a <code>JOIN</code> clause.</p>
<p><code>frame</code> (:class:<code>Frame</code>)
<pre>The joined frame.
</pre>
<code>condition</code> (:class:<code>Phrase</code> or <code>None</code>)
The join condition.</p>
<p><code>is_left</code> (Boolean)
Indicates that the join is <code>LEFT OUTER</code>.</p>
<p><code>is_right</code> (Boolean)
Indicates that the join is <code>RIGHT OUTER</code>.</p>
<p>Other attributes:</p>
<p><code>is_inner</code> (Boolean)
Indicates that the join is <code>INNER</code> (that is, not left or right).</p>
<p><code>is_cross</code> (Boolean)
Indicates that the join is <code>CROSS</code> (that is, inner without
any join condition).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Anchor</span><span class="p">(</span><span class="n">Clause</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-30'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-30">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-31'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-31">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">is_left</span><span class="p">,</span> <span class="n">is_right</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">Frame</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">frame</span><span class="o">.</span><span class="n">is_segment</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">maybe</span><span class="p">(</span><span class="n">Phrase</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">condition</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">BooleanDomain</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_left</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_right</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Anchor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">expression</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_left</span> <span class="o">=</span> <span class="n">is_left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_right</span> <span class="o">=</span> <span class="n">is_right</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_inner</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">is_left</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_cross</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_inner</span> <span class="ow">and</span> <span class="n">condition</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-32'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-32">#</a>
        </div>
        <p>Represents the leading frame in the <code>FROM</code> list.</p>
<p><code>frame</code> (:class:<code>Frame</code>)
<pre>The leading frame.
</pre>
<code>condition</code> (<code>None</code>)
The join condition.</p>
<p><code>is_left</code> (<code>False</code>)
Indicates that the join is <code>LEFT OUTER</code>.</p>
<p><code>is_right</code> (<code>False</code>)
Indicates that the join is <code>RIGHT OUTER</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">LeadingAnchor</span><span class="p">(</span><span class="n">Anchor</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-33'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-33">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-34'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-34">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">is_left</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">is_right</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-35'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-35">#</a>
        </div>
        <p>We retain the constructor arguments to faciliate <code>clone()</code>, but
we ensure that their values are always fixed.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">assert</span> <span class="n">condition</span> <span class="ow">is</span> <span class="bp">None</span>
        <span class="k">assert</span> <span class="n">is_left</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">is_right</span> <span class="ow">is</span> <span class="bp">False</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LeadingAnchor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span>
                                            <span class="n">is_left</span><span class="p">,</span> <span class="n">is_right</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-36'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-36">#</a>
        </div>
        <p>Represents the whole HTSQL query.</p>
<p><code>segment</code> (:class:<code>SegmentFrame</code> or <code>None</code>)
<pre>The query segment.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">QueryFrame</span><span class="p">(</span><span class="n">Clause</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-37'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-37">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-38'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-38">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment</span><span class="p">,</span> <span class="n">term</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">segment</span><span class="p">,</span> <span class="n">maybe</span><span class="p">(</span><span class="n">SegmentFrame</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">QueryTerm</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QueryFrame</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">expression</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment</span> <span class="o">=</span> <span class="n">segment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">term</span> <span class="o">=</span> <span class="n">term</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-39'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-39">#</a>
        </div>
        <p></pre>Represents a SQL expression.</p>
<p><code>domain</code> (:class:<code>htsql.domain.Domain</code>)
<pre>The co-domain of the expression.
</pre>
<code>is_nullable</code> (Boolean)
Indicates if the expression may evaluate to <code>NULL</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">Phrase</span><span class="p">(</span><span class="n">Clause</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-40'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-40">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-41'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-41">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">equality_vector</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">Domain</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_nullable</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Phrase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">equality_vector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_nullable</span> <span class="o">=</span> <span class="n">is_nullable</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-42'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-42">#</a>
        </div>
        <p>Represents a literal value.</p>
<p><code>value</code> (valid type depends on the domain)
<pre>The value.
</pre>
<code>domain</code> (:class:<code>htsql.domain.Domain</code>)
The value type.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">LiteralPhrase</span><span class="p">(</span><span class="n">Phrase</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-43'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-43">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-44'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-44">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-45'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-45">#</a>
        </div>
        <p>Note: <code>NULL</code> values are represented as <code>None</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">is_nullable</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">equality_vector</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LiteralPhrase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span>
                                            <span class="n">equality_vector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-46'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-46">#</a>
        </div>
        <p>Represents a <code>NULL</code> value.</p>
<p><code>NULL</code> values are commonly generated and checked for, so for
convenience, they are extracted in a separate class.  Note that
it is also valid for a <code>NULL</code> value to be represented as a regular
:class:<code>LiteralPhrase</code> instance.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">NullPhrase</span><span class="p">(</span><span class="n">LiteralPhrase</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-47'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-47">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-48'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-48">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NullPhrase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-49'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-49">#</a>
        </div>
        <p>Represents a <code>TRUE</code> value.</p>
<p><code>TRUE</code> values are commonly generated and checked for, so for
convenience, they are extracted in a separate class.  Note that
it is also valid for a <code>TRUE</code> value to be represented as a regular
:class:<code>LiteralPhrase</code> instance.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">TruePhrase</span><span class="p">(</span><span class="n">LiteralPhrase</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-50'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-50">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-51'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-51">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="nb">coerce</span><span class="p">(</span><span class="n">BooleanDomain</span><span class="p">())</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TruePhrase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-52'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-52">#</a>
        </div>
        <p>Represents a <code>FALSE</code> value.</p>
<p><code>FALSE</code> values are commonly generated and checked for, so for
convenience, they are extracted in a separate class.  Note that
it is also valid for a <code>FALSE</code> value to be represented as a regular
:class:<code>LiteralPhrase</code> instance.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">FalsePhrase</span><span class="p">(</span><span class="n">LiteralPhrase</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-53'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-53">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-54'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-54">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="nb">coerce</span><span class="p">(</span><span class="n">BooleanDomain</span><span class="p">())</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FalsePhrase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-55'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-55">#</a>
        </div>
        <p>Represents the <code>CAST</code> operator.</p>
<p><code>base</code> (:class:<code>Phrase</code>)
<pre>The expression to convert.
</pre>
<code>domain</code> (:class:<code>htsql.domain.Domain</code>)
The target domain.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">CastPhrase</span><span class="p">(</span><span class="n">Phrase</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-56'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-56">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-57'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-57">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">Phrase</span><span class="p">)</span>
        <span class="n">equality_vector</span> <span class="o">=</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CastPhrase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span>
                                         <span class="n">equality_vector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">base</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-58'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-58">#</a>
        </div>
        <p>Represents a formula phrase.</p>
<p>A formula phrase represents a function or an operator call as
a phrase node.</p>
<p><code>signature</code> (:class:<code>htsql.tr.signature.Signature</code>)
<pre>The signature of the formula.
</pre>
<code>domain</code> (:class:<code>Domain</code>)
The co-domain of the formula.</p>
<p><code>arguments</code> (a dictionary)
The arguments of the formula.</p>
<p>Note that all the arguments become attributes of the node object.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">FormulaPhrase</span><span class="p">(</span><span class="n">Formula</span><span class="p">,</span> <span class="n">Phrase</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-59'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-59">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-60'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-60">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="o">**</span><span class="n">arguments</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signature</span><span class="p">,</span> <span class="n">Signature</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-61'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-61">#</a>
        </div>
        <p>Check that the arguments match the formula signature.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="n">arguments</span> <span class="o">=</span> <span class="n">Bag</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">arguments</span><span class="o">.</span><span class="n">admits</span><span class="p">(</span><span class="n">Phrase</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span>
        <span class="n">equality_vector</span> <span class="o">=</span> <span class="p">(</span><span class="n">signature</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">freeze</span><span class="p">())</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-62'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-62">#</a>
        </div>
        <p>The first tow arguments are processed by the <code>Formula</code>
constructor; the rest of them go to the <code>Phrase</code> constructor.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="nb">super</span><span class="p">(</span><span class="n">FormulaPhrase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">signature</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span>
                                            <span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span>
                                            <span class="n">equality_vector</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-63'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-63">#</a>
        </div>
        <p>Represents a value exported from another frame.</p>
<p>This is an abstract class; for concrete subclasses, see
:class:<code>ColumnPhrase</code>, :class:<code>ReferencePhrase</code>, and
:class:<code>EmbeddingPhrase</code>.</p>
<p><code>tag</code> (an integer)
<pre>The tag of the frame that exports the value.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">ExportPhrase</span><span class="p">(</span><span class="n">Phrase</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-64'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-64">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-65'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-65">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">equality_vector</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExportPhrase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span>
                                           <span class="n">equality_vector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-66'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-66">#</a>
        </div>
        <p></pre>Represents a column exported from a table frame.</p>
<p><code>tag</code> (an integer)
<pre>The tag of the table frame.
</pre>
The tag must point to an immediate child of the current frame.</p>
<p><code>class</code> (:class:<code>htsql.entity.ColumnEntity</code>)
The column to export.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">ColumnPhrase</span><span class="p">(</span><span class="n">ExportPhrase</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-67'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-67">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-68'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-68">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">ColumnEntity</span><span class="p">)</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">domain</span>
        <span class="n">equality_vector</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ColumnPhrase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span>
                                           <span class="n">expression</span><span class="p">,</span> <span class="n">equality_vector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">column</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-69'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-69">#</a>
        </div>
        <p>Represents a value exported from a nested sub-<code>SELECT</code> frame.</p>
<p><code>tag</code> (an integer)
<pre>The tag of the nested frame.
</pre>
The tag must point to an immediate child of the current frame.</p>
<p><code>index</code> (an integer)
The position of the exported value in the <code>SELECT</code> clause.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">ReferencePhrase</span><span class="p">(</span><span class="n">ExportPhrase</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-70'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-70">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-71'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-71">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="n">equality_vector</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ReferencePhrase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span>
                                              <span class="n">expression</span><span class="p">,</span> <span class="n">equality_vector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-72'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-72">#</a>
        </div>
        <p>Represents an embedding of a correlated subquery.</p>
<p><code>tag</code> (an integer)
<pre>The tag of the nested frame.
</pre>
The tag must point to one of the subframes contained in the
<code>embed</code> list of the current frame.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">EmbeddingPhrase</span><span class="p">(</span><span class="n">ExportPhrase</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-73'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-73">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-74'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-74">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
        <span class="n">equality_vector</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span><span class="p">,)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EmbeddingPhrase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">is_nullable</span><span class="p">,</span>
                                              <span class="n">expression</span><span class="p">,</span> <span class="n">equality_vector</span><span class="p">)</span>

</pre></div></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
