<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>coerce.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>coerce.py</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-0'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-0">#</a>
        </div>
        <p>Copyright (c) 2006-2011, Prometheus Research, LLC
See <code>LICENSE</code> for license information, <code>AUTHORS</code> for the list of authors.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-1'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-1">#</a>
        </div>
        <h1>:mod:<code>htsql.tr.coerce</code></h1>
<p>This module implements the unary and binary coerce adapters.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="kn">from</span> <span class="nn">..util</span> <span class="kn">import</span> <span class="n">listof</span>
<span class="kn">from</span> <span class="nn">..adapter</span> <span class="kn">import</span> <span class="n">Adapter</span><span class="p">,</span> <span class="n">adapts</span><span class="p">,</span> <span class="n">adapts_many</span>
<span class="kn">from</span> <span class="nn">..domain</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Domain</span><span class="p">,</span> <span class="n">VoidDomain</span><span class="p">,</span> <span class="n">TupleDomain</span><span class="p">,</span> <span class="n">UntypedDomain</span><span class="p">,</span>
                      <span class="n">BooleanDomain</span><span class="p">,</span> <span class="n">IntegerDomain</span><span class="p">,</span> <span class="n">DecimalDomain</span><span class="p">,</span> <span class="n">FloatDomain</span><span class="p">,</span>
                      <span class="n">StringDomain</span><span class="p">,</span> <span class="n">EnumDomain</span><span class="p">,</span> <span class="n">DateDomain</span><span class="p">,</span> <span class="n">TimeDomain</span><span class="p">,</span>
                      <span class="n">DateTimeDomain</span><span class="p">,</span> <span class="n">OpaqueDomain</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-2'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-2">#</a>
        </div>
        <p>Validates and specializes a domain.</p>
<p>The :class:<code>UnaryCoerce</code> adapter has the following signature::</p>
<pre>UnaryCoerce: Domain -> maybe(Domain)
</pre>

<p>The adapter checks if the given domain is valid.  If so, the domain
or its specialized version is returned; otherwise, <code>None</code> is returned.</p>
<p>The primary use cases are:</p>
<ul>
<li>
<p>disabling special domains in regular expressions;</p>
</li>
<li>
<p>specializing untyped values;</p>
</li>
<li>
<p>providing engine-specific versions of generic domains.</p>
</li>
</ul>
<p>The adapter is rarely used directly, use :func:<code>coerce</code> instead.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">UnaryCoerce</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-3'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-3">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts</span><span class="p">(</span><span class="n">Domain</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-4'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-4">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-5'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-5">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-6'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-6">#</a>
        </div>
        <p>By default, we assume that the domain is valid and specializes
into itself.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-7'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-7">#</a>
        </div>
        <p>Determines a common domain of two domains.</p>
<p>The :class:<code>BinaryCoerce</code> adapter has the following signature::</p>
<pre>BinaryCoerce: (Domain, Domain) -> maybe(Domain)
</pre>

<p>:class:<code>BinaryCoerce</code> is polymorphic on both arguments.</p>
<p>The adapter checks if two domains could be reduced to a single common
domains.  If the common domain cannot be determined, the adapter returns
<code>None</code>.</p>
<p>The primary use cases are:</p>
<ul>
<li>
<p>checking if two domains are compatible (that is, if values of these
domains are comparable without explicit cast).</p>
</li>
<li>
<p>deducing the actual type of untyped values.</p>
</li>
</ul>
<p>The adapter is rarely used directly, use :func:<code>coerce</code> instead.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BinaryCoerce</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-8'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-8">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts</span><span class="p">(</span><span class="n">Domain</span><span class="p">,</span> <span class="n">Domain</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-9'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-9">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ldomain</span><span class="p">,</span> <span class="n">rdomain</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ldomain</span> <span class="o">=</span> <span class="n">ldomain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdomain</span> <span class="o">=</span> <span class="n">rdomain</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-10'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-10">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-11'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-11">#</a>
        </div>
        <p>By default, we assume that the domain is compatible with itself.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ldomain</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdomain</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ldomain</span>
        <span class="k">return</span> <span class="bp">None</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-12'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-12">#</a>
        </div>
        <p>Disables special domains.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">UnaryCoerceSpecial</span><span class="p">(</span><span class="n">UnaryCoerce</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-13'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-13">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">(</span><span class="n">VoidDomain</span><span class="p">,</span>
                <span class="n">TupleDomain</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-14'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-14">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-15'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-15">#</a>
        </div>
        <p><code>VoidDomain</code> and <code>TupleDomain</code> values cannot be compared.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="bp">None</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-16'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-16">#</a>
        </div>
        <p>Specializes untyped values.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">UnaryCoerceUntyped</span><span class="p">(</span><span class="n">UnaryCoerce</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-17'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-17">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts</span><span class="p">(</span><span class="n">UntypedDomain</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-18'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-18">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-19'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-19">#</a>
        </div>
        <p>Specializes untyped top-level expressions to the string type.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="n">StringDomain</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-20'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-20">#</a>
        </div>
        <p>Coerces untyped values to :class:<code>BooleanDomain</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BinaryCoerceBoolean</span><span class="p">(</span><span class="n">BinaryCoerce</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-21'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-21">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">((</span><span class="n">BooleanDomain</span><span class="p">,</span> <span class="n">BooleanDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">BooleanDomain</span><span class="p">,</span> <span class="n">UntypedDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">UntypedDomain</span><span class="p">,</span> <span class="n">BooleanDomain</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-22'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-22">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">BooleanDomain</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-23'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-23">#</a>
        </div>
        <p>Coerces untyped values to :class:<code>IntegerDomain</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BinaryCoerceInteger</span><span class="p">(</span><span class="n">BinaryCoerce</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-24'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-24">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">((</span><span class="n">IntegerDomain</span><span class="p">,</span> <span class="n">IntegerDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">IntegerDomain</span><span class="p">,</span> <span class="n">UntypedDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">UntypedDomain</span><span class="p">,</span> <span class="n">IntegerDomain</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-25'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-25">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-26'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-26">#</a>
        </div>
        <p>Note that we use the generic version of the domain.  Engine addons
may override this implementation to provide an engine-specific
version of the domain.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="n">IntegerDomain</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-27'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-27">#</a>
        </div>
        <p>Coerces untyped and integer values to :class:<code>DecimalDomain</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BinaryCoerceDecimal</span><span class="p">(</span><span class="n">BinaryCoerce</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-28'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-28">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">((</span><span class="n">DecimalDomain</span><span class="p">,</span> <span class="n">DecimalDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">DecimalDomain</span><span class="p">,</span> <span class="n">IntegerDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">DecimalDomain</span><span class="p">,</span> <span class="n">UntypedDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">IntegerDomain</span><span class="p">,</span> <span class="n">DecimalDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">UntypedDomain</span><span class="p">,</span> <span class="n">DecimalDomain</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-29'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-29">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-30'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-30">#</a>
        </div>
        <p>Note that we use the generic version of the domain.  Engine addons
may override this implementation to provide an engine-specific
version of the domain.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="n">DecimalDomain</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-31'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-31">#</a>
        </div>
        <p>Coerces untyped, integer and decimal values to :class:<code>FloatDomain</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BinaryCoerceFloat</span><span class="p">(</span><span class="n">BinaryCoerce</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-32'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-32">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">((</span><span class="n">FloatDomain</span><span class="p">,</span> <span class="n">FloatDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">FloatDomain</span><span class="p">,</span> <span class="n">DecimalDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">FloatDomain</span><span class="p">,</span> <span class="n">IntegerDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">FloatDomain</span><span class="p">,</span> <span class="n">UntypedDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">DecimalDomain</span><span class="p">,</span> <span class="n">FloatDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">IntegerDomain</span><span class="p">,</span> <span class="n">FloatDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">UntypedDomain</span><span class="p">,</span> <span class="n">FloatDomain</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-33'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-33">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FloatDomain</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-34'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-34">#</a>
        </div>
        <p>Coerces untyped values to :class:<code>StringDomain</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BinaryCoerceString</span><span class="p">(</span><span class="n">BinaryCoerce</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-35'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-35">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">((</span><span class="n">StringDomain</span><span class="p">,</span> <span class="n">StringDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">StringDomain</span><span class="p">,</span> <span class="n">UntypedDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">UntypedDomain</span><span class="p">,</span> <span class="n">StringDomain</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-36'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-36">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-37'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-37">#</a>
        </div>
        <p>Note that we use the generic version of the domain.  Engine addons
may override this implementation to provide an engine-specific
version of the domain.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">return</span> <span class="n">StringDomain</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-38'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-38">#</a>
        </div>
        <p>Validates and coerces to :class:<code>EnumDomain</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BinaryCoerceEnum</span><span class="p">(</span><span class="n">BinaryCoerce</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-39'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-39">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">((</span><span class="n">EnumDomain</span><span class="p">,</span> <span class="n">EnumDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">EnumDomain</span><span class="p">,</span> <span class="n">UntypedDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">UntypedDomain</span><span class="p">,</span> <span class="n">EnumDomain</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-40'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-40">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-41'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-41">#</a>
        </div>
        <p>Note that <code>EnumDomain</code> represents not a single domain,
but a family of (incompatible) domains.  We assume that
only equal enum domains are compatible; the engines
should either satisfy this assumption or override this
implementation.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ldomain</span><span class="p">,</span> <span class="n">UntypedDomain</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdomain</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rdomain</span><span class="p">,</span> <span class="n">UntypedDomain</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ldomain</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ldomain</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdomain</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ldomain</span>
        <span class="k">return</span> <span class="bp">None</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-42'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-42">#</a>
        </div>
        <p>Coerce to :class:<code>DateDomain</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BinaryCoerceDate</span><span class="p">(</span><span class="n">BinaryCoerce</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-43'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-43">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">((</span><span class="n">DateDomain</span><span class="p">,</span> <span class="n">DateDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">DateDomain</span><span class="p">,</span> <span class="n">UntypedDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">UntypedDomain</span><span class="p">,</span> <span class="n">DateDomain</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-44'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-44">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DateDomain</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-45'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-45">#</a>
        </div>
        <p>Coerce to :class:<code>TimeDomain</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BinaryCoerceTime</span><span class="p">(</span><span class="n">BinaryCoerce</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-46'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-46">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">((</span><span class="n">TimeDomain</span><span class="p">,</span> <span class="n">TimeDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">TimeDomain</span><span class="p">,</span> <span class="n">UntypedDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">UntypedDomain</span><span class="p">,</span> <span class="n">TimeDomain</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-47'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-47">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">TimeDomain</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-48'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-48">#</a>
        </div>
        <p>Coerce to :class:<code>DateTimeDomain</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BinaryCoerceDateTime</span><span class="p">(</span><span class="n">BinaryCoerce</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-49'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-49">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts_many</span><span class="p">((</span><span class="n">DateTimeDomain</span><span class="p">,</span> <span class="n">DateTimeDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">DateTimeDomain</span><span class="p">,</span> <span class="n">UntypedDomain</span><span class="p">),</span>
                <span class="p">(</span><span class="n">UntypedDomain</span><span class="p">,</span> <span class="n">DateTimeDomain</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-50'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-50">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DateTimeDomain</span><span class="p">()</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-51'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-51">#</a>
        </div>
        <p>Validate and coerce to :class:<code>OpaqueDomain</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">class</span> <span class="nc">BinaryCoerceOpaque</span><span class="p">(</span><span class="n">BinaryCoerce</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-52'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-52">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">adapts</span><span class="p">(</span><span class="n">OpaqueDomain</span><span class="p">,</span> <span class="n">OpaqueDomain</span><span class="p">)</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-53'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-53">#</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-54'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-54">#</a>
        </div>
        <p>This is the default implementation; we duplicate it here
to emphasize it.  <code>OpaqueDomain</code> represents not a single
domain, but a family of (incompatible) domains.  We assume
that opaque domains are compatible when they are equal;
the engines should either satisfy this assumption or override
this implementation.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ldomain</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdomain</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ldomain</span>
        <span class="k">return</span> <span class="bp">None</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-55'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-55">#</a>
        </div>
        <p>Reduces a list of domains to a single common domain.</p>
<p><code>domains</code> (a list of :class:<code>htsql.domain.Domain</code>)
<pre>List of domains.
</pre>
Returns the most specialized domain covering the given domains;
<code>None</code> if the common domain could not be determined.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre><span class="k">def</span> <span class="nf">coerce</span><span class="p">(</span><span class="o">*</span><span class="n">domains</span><span class="p">):</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-56'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-56">#</a>
        </div>
        <p>FIXME: maybe overriding a builtin function is not a great idea?
It is deprecated though.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre></pre></div></pre></div>
      </td>
    </tr><tr id='section-57'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-57">#</a>
        </div>
        <p>Sanity check on the argument.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">domains</span><span class="p">),</span> <span class="n">listof</span><span class="p">(</span><span class="n">Domain</span><span class="p">))</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-58'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-58">#</a>
        </div>
        <p>The function should never be called with an empty list of <code>domains</code>,
but we handle this case for completeness; returning <code>None</code> is
the only option in this case.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="k">if</span> <span class="ow">not</span> <span class="n">domains</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span></pre></div></pre></div>
      </td>
    </tr><tr id='section-59'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-59">#</a>
        </div>
        <p>Now apply <code>BinaryCoerce</code> to the first two domains in the list,
then to the result of the operation and the third domain in the list,
and so on.  Finally, apply <code>UnaryCoerce</code> to the result:
  UnaryCoerce(...(BinaryCoerce(
                  BinaryCoerce(domains[0],domains[1]),domains[2]),...))</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><div class="highlight"><pre>    <span class="n">domain</span> <span class="o">=</span> <span class="n">domains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">domains</span><span class="p">):</span>
        <span class="n">ldomain</span> <span class="o">=</span> <span class="n">domain</span>
        <span class="n">rdomain</span> <span class="o">=</span> <span class="n">domains</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">binary_coerce</span> <span class="o">=</span> <span class="n">BinaryCoerce</span><span class="p">(</span><span class="n">ldomain</span><span class="p">,</span> <span class="n">rdomain</span><span class="p">)</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">binary_coerce</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">unary_coerce</span> <span class="o">=</span> <span class="n">UnaryCoerce</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">unary_coerce</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">domain</span>

</pre></div></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
